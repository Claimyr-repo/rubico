/**
 * rubico v1.6.18
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.flatten=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Array.isArray,t=Symbol.for("placeholder"),e=function(n,t){return n.push(t),n},o=n=>function(){return n},r=function(n,e,o){return e==t?((n,t)=>function(e){return n(e,t)})(n,o):((n,t)=>function(e){return n(t,e)})(n,e)},u=(n,t)=>t,f=n=>n,c=n=>null!=n&&"function"==typeof n.then,i=Promise.all.bind(Promise),s=(n,t)=>function(...e){return t(n(...e))},l=async function(n,t){const e=[];for await(const o of n){const n=t(o);c(n)&&e.push(n)}return 0==e.length?n:i(e).then(o(n))},a=Symbol.iterator,h=Symbol.asyncIterator,p=function(p){const d=p.length,y=[],w=[];let g=-1;for(;++g<d;){const o=p[g];if(n(o)){const n=o.length;let t=-1;for(;++t<n;)w.push(o[t])}else if(null==o)w.push(o);else if("function"==typeof o.then)y.push(o.then(r(e,w,t)));else if("function"==typeof o[a])for(const n of o)w.push(n);else if("function"==typeof o[h])y.push(l(o[h](),r(e,w,t)));else if("function"==typeof o.chain){const n=o.chain(f);c(n)?y.push(n.then(r(e,w,t))):w.push(n)}else if("function"==typeof o.flatMap){const n=o.flatMap(f);c(n)?y.push(n.then(r(e,w,t))):w.push(n)}else if("function"==typeof o.reduce){const n=o.reduce(s(u,r(e,w,t)),null);c(n)&&y.push(n)}else if(o.constructor==Object)for(const n in o)w.push(o[n]);else w.push(o)}return 0==y.length?w:i(y).then(o(w))},d=function(n,e,o,r){return e==t?((n,t,e)=>function(o){return n(o,t,e)})(n,o,r):o==t?((n,t,e)=>function(o){return n(t,o,e)})(n,e,r):((n,t,e)=>function(o){return n(t,e,o)})(n,e,o)},y=(n,t,e)=>n[t](e),w=function(e){e.size;const o=[],r=new Set,u=(n,t)=>r.add(t),s=d(y,r,"add",t);for(const t of e)if(n(t)){const n=t.length;let e=-1;for(;++e<n;)r.add(t[e])}else if(null==t)r.add(t);else if("function"==typeof t[a])for(const n of t)r.add(n);else if("function"==typeof t[h])o.push(l(t[h](),s));else if("function"==typeof t.chain){const n=t.chain(f);c(n)?o.push(n.then(s)):r.add(n)}else if("function"==typeof t.flatMap){const n=t.flatMap(f);c(n)?o.push(n.then(s)):r.add(n)}else if("function"==typeof t.reduce){const n=t.reduce(u,null);c(n)&&o.push(n)}else if(t.constructor==Object)for(const n in t)r.add(t[n]);else r.add(t);return 0==o.length?r:i(o).then((()=>r))},g=Object.assign,v=function(n){const e=[],o={},p=r(g,o,t),d=s(u,p);for(const t in n){const r=n[t];if(null!=r)if("function"==typeof r[a])for(const n of r)g(o,n);else if("function"==typeof r[h])e.push(l(r[h](),p));else if("function"==typeof r.chain){const n=r.chain(f);c(n)?e.push(n.then(p)):g(o,n)}else if("function"==typeof r.flatMap){const n=r.flatMap(f);c(n)?e.push(n.then(p)):p(n)}else if("function"==typeof r.reduce){const n=r.reduce(d,null);c(n)&&e.push(n)}else g(o,r)}return 0==e.length?o:i(e).then((()=>o))},b=Object.values,j=Object.prototype.toString,x=n=>j.call(n),M=n=>"[object GeneratorFunction]"==x(n),S=n=>"[object AsyncGeneratorFunction]"==x(n),m=async function(n,t,e){let o=n.next();if(o.done)return e;for(;!o.done;)e=t(e,o.value),c(e)&&(e=await e),o=n.next();return e},O=function(n,e,o){let r=n.next();if(r.done)return o;for(void 0===o&&(o=r.value,r=n.next());!r.done;){if(o=e(o,r.value),c(o))return o.then(d(m,n,e,t));r=n.next()}return o},A=async function(n,t,e){let o=await n.next();if(o.done)return e;for(void 0===e&&(e=o.value,o=await n.next());!o.done;)e=await t(e,o.value),o=await n.next();return e},B=function(n,e,o,r){return e==t?((n,t,e)=>function(...o){return n(o,t,e)})(n,o,r):o==t?((n,t,e)=>function(...o){return n(t,o,e)})(n,e,r):((n,t,e)=>function(...o){return n(t,e,o)})(n,e,o)},P=async function(n,t,e,o){const r=n.length;for(;++o<r;)e=t(e,n[o]),c(e)&&(e=await e);return e},F=function(n,e,o){const r=n.length;let u=-1;for(void 0===o&&(o=n[++u]);++u<r;)if(o=e(o,n[u]),c(o))return o.then((f=P,s=e,l=t,a=u,(i=n)==t?((n,t,e,o)=>function(r){return n(r,t,e,o)})(f,s,l,a):s==t?((n,t,e,o)=>function(r){return n(t,r,e,o)})(f,i,l,a):l==t?((n,t,e,o)=>function(r){return n(t,e,r,o)})(f,i,s,a):((n,t,e,o)=>function(r){return n(t,e,o,r)})(f,i,s,l)));var f,i,s,l,a;return o},z=(n,e)=>function(o,u){const f=n(o,u);return c(f)?f.then(r(e,t,u)):e(f,u)},G=function(e,o,u){const f=e[0];return n(f)?F(f,o,u):"function"==typeof f?M(f)?((n,e,o)=>s(n,d(O,t,e,o)))(f,o,u):S(f)?((n,e,o)=>s(n,d(A,t,e,o)))(f,o,u):B(G,t,1==e.length?z(o,f):e.reduce(z,o),u):null==f?void 0===u?r(o,f,t):o(u,f):"function"==typeof f[a]?O(f[a](),o,u):"function"==typeof f[h]?A(f[h](),o,u):"function"==typeof f.reduce?f.reduce(o,u):"function"==typeof f.chain?f.chain(r(o,u,t)):"function"==typeof f.flatMap?f.flatMap(r(o,u,t)):f.constructor==Object?F(b(f),o,u):void 0===u?r(o,f,t):o(u,f)},I=function(n,t){let o=[],r=0;return{[a](){return this},next(){if(r<o.length){const n=o[r];return r+=1,{value:n,done:!1}}const u=n.next();if(u.done)return u;const f=G([t(u.value)],e,[]);return f.length>1&&(o=f,r=1),{value:f[0],done:!1}}}},T=Promise.race.bind(Promise),V=function(n,o){const r=[],u=new Set;return{[h](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){if(r.length>0)return{value:r.shift(),done:!1};const{value:f,done:i}=await n.next();if(i)return u.size>0?(await T(u),{value:r.shift(),done:!1}):{value:void 0,done:!0};const s=o(f);if(c(s)){const n=s.then(B(G,t,e,r)).then((()=>u.delete(n)));u.add(n),await T(u)}else{const n=G([s],e,r);if(c(n)){const t=n.then((()=>u.delete(t)));u.add(t),await T(u)}}return{value:r.shift(),done:!1}}}},k=ArrayBuffer.isView,q=function(n,t){const e=n.length,o=Array(e);let r=-1,u=!1;for(;++r<e;){const e=t(n[r]);c(e)&&(u=!0),o[r]=e}return u?i(o):o},C=n=>new Promise((n=>function(t){const e={};let o=0;for(const r in n){const u=n[r];c(u)?(o+=1,u.then((n=>function(r){e[n]=r,o-=1,0==o&&t(e)})(r))):e[r]=u}0==o&&t(e)})(n)),D=function(n,t){const e=function(n,t){const e={};let o=!1;for(const r in n){const u=t(n[r]);c(u)&&(o=!0),e[r]=u}return o?C(e):e}(n,t);return c(e)?e.then(v):v(e)},E=function(n,e){const r=function(n,e){const r=new Set,u=[];for(const o of n){const n=e(o);c(n)?u.push(n.then(d(y,r,"add",t))):r.add(n)}return 0==u.length?r:i(u).then(o(r))}(n,e);return c(r)?r.then(w):w(r)},H=(J=p,K=r(((n,t)=>n.join(t)),t,""),function(...n){const t=J(...n);return c(t)?t.then(K):K(t)});var J,K;const L=function(n,t,e,o){return n.write(t,e,o),n},N=async function(e,p){const d=r(L,e,t),y=s(u,d),w=[];if(n(p)){const n=p.length;let t=-1;for(;++t<n;)e.write(p[t])}else if(null==p)e.write(p);else if("function"==typeof p[a])for(const n of p)e.write(n);else if("function"==typeof p[h])w.push(l(p[h](),d));else if("function"==typeof p.chain){const n=p.chain(f);c(n)?w.push(n.then(d)):e.write(n)}else if("function"==typeof p.flatMap){const n=p.flatMap(f);c(n)?w.push(n.then(d)):e.write(n)}else if("function"==typeof p.reduce){const n=p.reduce(y,null);c(n)&&w.push(n)}else if(p.constructor==Object)for(const n in p)e.write(p[n]);else e.write(p);return 0==w.length?e:i(w).then(o(e))},Q="function"==typeof Buffer,R=Q?Buffer.alloc:function(){},U=function(n,t){const e=n.length,o=Q&&n.constructor==Buffer?R(e+t.length):new n.constructor(e+t.length);return o.set(n),o.set(t,e),o},W=function(t,e){return n(e)||k(e)?U(t,e):U(t,[e])},X=function(n,t){const e=n.length;let o=-1,r=t;for(;++o<e;)r=W(r,n[o]);return r},Y=function(n,e){const o=p(n);return c(o)?o.then(r(X,t,e)):X(o,e)},Z=e=>function(o){if(n(o))return function(n,t){const e=q(n,t);return c(e)?e.then(p):p(e)}(o,e);if("function"==typeof o)return M(o)?((n,t)=>function*(...e){yield*I(n(...e),t)})(o,e):S(o)?((n,t)=>async function*(...e){yield*V(n(...e),t)})(o,e):((n,e)=>function(o,r){const u=e(r);return c(u)?u.then(B(G,t,n,o)):G([u],n,o)})(o,e);if(k(o))return function(n,e){const o=q(n,e),u=Q&&n.constructor==Buffer?R(0):new n.constructor(0);return c(o)?o.then(r(Y,t,u)):Y(o,u)}(o,e);if(null==o)return e(o);if("function"==typeof o.then)return o.then(e);if("function"==typeof o.next)return a in o?I(o,e):V(o,e);if("function"==typeof o.chain)return o.chain(e);if("function"==typeof o.flatMap)return o.flatMap(e);if("function"==typeof o[h]&&"function"==typeof o.write)return async function(n,e){const o=new Set;for await(const u of n){const f=e(u);if(c(f)){const e=f.then(r(N,n,t)).then((()=>o.delete(e)));o.add(e)}else{const t=N(n,f);if(c(t)){const n=t.then((()=>o.delete(n)));o.add(n)}}}return await i(o),n}(o,e);const u=o.constructor;return u==Object?D(o,e):u==Set?E(o,e):"string"==typeof o||u==String?function(n,t){const e=q(n,t);return c(e)?e.then(H):H(e)}(o,e):e(o)};return function(t){return n(t)?p(t):null==t?t:t.constructor==Set?w(t):t.constructor==Object?v(t):Z(f)(t)}}());
