/**
 * rubico v1.6.2
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.pluck=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=n=>null!=n&&"function"==typeof n.then,t=(t,o)=>function(...r){const e=t(...r);return n(e)?e.then(o):o(e)},o=Symbol.iterator,r=(n,t)=>({toString:()=>"[object MappingIterator]",[o](){return this},next(){const o=n.next();return o.done?o:{value:t(o.value),done:!1}}}),e=n=>({value:n,done:!1}),c=Symbol.asyncIterator,u=(t,o)=>({[c](){return this},async next(){const r=await t.next();if(r.done)return r;const c=o(r.value);return n(c)?c.then(e):{value:c,done:!1}}}),i=Array.isArray,f=Object.prototype.toString,s=n=>f.call(n),l=Promise.all.bind(Promise),a=function(t,o){const r=t.length,e=Array(r);let c=-1,u=!1;for(;++c<r;){const r=o(t[c]);n(r)&&(u=!0),e[c]=r}return u?l(e):e},h=Symbol.for("placeholder"),y=(t,o)=>function(r,e){const c=o(e);return n(c)?c.then((u=t,f=h,(i=r)==h?((n,t)=>function(o){return n(o,t)})(u,f):((n,t)=>function(o){return n(t,o)})(u,i))):t(r,c);var u,i,f},p=function(n,t,o,r){return t==h?((n,t,o)=>function(r){return n(r,t,o)})(n,o,r):o==h?((n,t,o)=>function(r){return n(t,r,o)})(n,t,r):((n,t,o)=>function(r){return n(t,o,r)})(n,t,o)},d=(n,t,o)=>n[t](o),w=n=>function(){return n},g=function(n,t,o,r,e){return t==h?((n,t,o,r)=>function(e){return n(e,t,o,r)})(n,o,r,e):o==h?((n,t,o,r)=>function(e){return n(t,e,o,r)})(n,t,r,e):r==h?((n,t,o,r)=>function(e){return n(t,o,e,r)})(n,t,o,e):((n,t,o,r)=>function(e){return n(t,o,r,e)})(n,t,o,r)},b=(n,t,o,r)=>n[t](o,r),j=t=>new Promise((t=>function(o){const r={};let e=0;for(const c in t){const u=t[c];n(u)?(e+=1,u.then((n=>function(t){r[n]=t,e-=1,0==e&&o(r)})(c))):r[c]=u}0==e&&o(r)})(t)),m=function(n,t,o){return n[t]=o,n},A=async function(t,o,r,e){const c=t.length;for(;++e<c;){const c=o(t[e]);r[e]=n(c)?await c:c}return r},S=n=>function(...t){return n(...t),t[0]},v=Promise.race.bind(Promise),x=async function(t,o,r,e,c,u){const i=t.length;for(;++c<i;){u.size>=r&&await v(u);const i=o(t[c]);if(n(i)){const n=i.then(S((()=>u.delete(n))));u.add(n),e[c]=n}else e[c]=i}return l(e)},P=Object.prototype.hasOwnProperty,T=(n,t)=>P.call(n,t),O=t=>function(e){return i(e)?a(e,t):"function"==typeof e?(n=>"[object GeneratorFunction]"==s(n))(e)?((n,t)=>function*(...o){for(const r of n(...o))yield t(r)})(e,t):(n=>"[object AsyncGeneratorFunction]"==s(n))(e)?function(n,t){return async function*(...o){for await(const r of n(...o))yield t(r)}}(e,t):y(e,t):null==e?e:"function"==typeof e.map?e.map(t):"function"==typeof e.next?o in e?r(e,t):u(e,t):"string"==typeof e||e.constructor==String?function(t,o){const r=a(t,o);return n(r)?r.then(p(d,h,"join","")):r.join("")}(e,t):e.constructor==Set?function(t,o){const r=new Set,e=[];for(const c of t){const t=o(c);n(t)?e.push(t.then(p(d,r,"add",h))):r.add(t)}return 0==e.length?r:l(e).then(w(r))}(e,t):e.constructor==Map?function(t,o){const r=new Map,e=[];for(const[c,u]of t){const t=o(u);n(t)?e.push(t.then(g(b,r,"set",c,h))):r.set(c,t)}return 0==e.length?r:l(e).then(w(r))}(e,t):e.constructor==Object?function(t,o){const r={};let e=!1;for(const c in t){const u=o(t[c]);n(u)&&(e=!0),r[c]=u}return e?j(r):r}(e,t):t(e)};O.series=o=>function(r){if(i(r))return function(o,r){const e=o.length,c=Array(e);let u=-1;for(;++u<e;){const e=r(o[u]);if(n(e))return e.then(t(p(m,c,u,h),g(A,o,r,h,u)));c[u]=e}return c}(r,o);throw new TypeError(r+" is not an Array")},O.pool=(t,o)=>function(r){if(i(r))return function(t,o,r){const e=t.length,c=Array(e);let u=-1;for(;++u<e;){const e=o(t[u]);if(n(e)){const n=new Set,i=e.then(S((()=>n.delete(i))));return n.add(i),c[u]=i,x(t,o,r,c,u,n)}c[u]=e}return c}(r,o,t);throw new TypeError(r+" is not an Array")},O.withIndex=t=>function(o){if(i(o))return function(t,o){const r=t.length,e=Array(r);let c=-1,u=!1;for(;++c<r;){const r=o(t[c],c,t);n(r)&&(u=!0),e[c]=r}return u?l(e):e}(o,t);throw new TypeError(o+" is not an Array")},O.own=t=>function(o){if((n=>null!=n&&("object"==typeof n||"function"==typeof n))(o)&&!i(o))return function(t,o){const r={};let e=!1;for(const c in t)if(T(t,c)){const u=o(t[c]);n(u)&&(e=!0),r[c]=u}return e?j(r):r}(o,t);throw new TypeError(o+" is not an Object")};const E=/[.|[|\]]+/,M=function(n,t){const o=new Map,r=function(r){if(o.has(r))return o.get(r);const e=n(r);return o.set(r,e),o.size>t&&o.clear(),e};return r.cache=o,r}((function(n){const t=n.length-1,o="["==n[0],r="]"==n[t];return o&&r?n.slice(1,t).split(E):o?n.slice(1).split(E):r?n.slice(0,t).split(E):n.split(E)}),500),I=function(n,t){const o=(n=>i(n)?n:"string"==typeof n?M(n):[n])(t),r=o.length;let e=-1,c=n;for(;++e<r;)if(c=c[o[e]],null==c)return;return c};return t(((n,t)=>function(o){const r=null==o?void 0:I(o,n);return void 0===r?"function"==typeof t?t(o):t:r}),O)}());
