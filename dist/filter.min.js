/**
 * rubico v1.6.5
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.filter=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Symbol.iterator,t=(t,e)=>({[n](){return this},next(){let n=t.next();for(;!n.done;){const{value:o}=n;if(e(o))return{value:o,done:!1};n=t.next()}return n}}),e=n=>null!=n&&"function"==typeof n.then,o=Symbol.asyncIterator,r=(n,t)=>({[o](){return this},async next(){let o=await n.next();for(;!o.done;){const{value:r}=o,u=t(r);if(e(u)?await u:u)return{value:r,done:!1};o=await n.next()}return o}}),u=Array.isArray,c=Object.prototype.toString,i=n=>c.call(n),f=Symbol.for("placeholder"),s=function(n,t,e,o,r){return t==f?((n,t,e,o)=>function(r){return n(r,t,e,o)})(n,e,o,r):e==f?((n,t,e,o)=>function(r){return n(t,r,e,o)})(n,t,o,r):o==f?((n,t,e,o)=>function(r){return n(t,e,r,o)})(n,t,e,r):((n,t,e,o)=>function(r){return n(t,e,o,r)})(n,t,e,o)},l=Promise.all.bind(Promise),h=function(n,t,e,o){const r=t.length;let u=n.length-1;for(;++o<r;)n[++u]=e(t[o]);return n},a=function(n,t,e,o){const r=n.length;let u=-1;for(;++e<r;)o[++u]&&t.push(n[e]);return t},y=function(n,t){const o=n.length,r=[];let u=-1,c=-1;for(;++u<o;){const o=n[u],i=t(o);if(e(i))return l(h([i],n,t,u)).then(s(a,n,r,u-1,f));i&&(r[++c]=o)}return r},p=function(n,t,e,o){return t==f?((n,t,e)=>function(o){return n(o,t,e)})(n,e,o):e==f?((n,t,e)=>function(o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(o){return n(t,e,o)})(n,t,e)},d=(n,t,e)=>n?t():e(),g=n=>function(){return n},b=(n,t,e)=>n[t](e),x=(n,t)=>function(){return n(t)},j=function(){},w=(n,t,e,o,r)=>function(){return n(t,e,o,r)},m=(n,t,e,o)=>n[t](e,o),S=function(n,t,e,o){o&&(n[t]=e)},v=function(n,t,e,o){const r=t.length;let u=n.length-1;for(;++o<r;)n[++u]=e(t[o],o,t);return n},A=o=>function(c){return u(c)?y(c,o):"function"==typeof c?(n=>"[object GeneratorFunction]"==i(n))(c)?((n,e)=>function*(...o){yield*t(n(...o),e)})(c,o):(n=>"[object AsyncGeneratorFunction]"==i(n))(c)?((n,t)=>async function*(...e){yield*r(n(...e),t)})(c,o):((n,t)=>function(o,r){const u=t(r);return e(u)?u.then(p(d,f,(c=n,i=o,s=r,function(){return c(i,s)}),g(o))):u?n(o,r):o;var c,i,s})(c,o):null==c?c:"function"==typeof c.next?n in c?t(c,o):r(c,o):"string"==typeof c||c.constructor==String?function(n,t){const o=y(n,t);return e(o)?o.then(p(b,f,"join","")):o.join("")}(c,o):c.constructor==Set?function(n,t){const o=new Set,r=o.add.bind(o),u=[];for(const c of n){const n=t(c);e(n)?u.push(n.then(p(d,f,x(r,c),j))):n&&o.add(c)}return 0==u.length?o:l(u).then(g(o))}(c,o):c.constructor==Map?function(n,t){const o=new Map,r=[];for(const[u,c]of n){const n=t(c);e(n)?r.push(n.then(p(d,f,w(m,o,"set",u,c),j))):n&&o.set(u,c)}return 0==r.length?o:l(r).then(g(o))}(c,o):"function"==typeof c.filter?c.filter(o):c.constructor==Object?function(n,t){const o={},r=[];for(const u in n){const c=n[u],i=t(c);e(i)?r.push(i.then(s(S,o,u,n[u],f))):i&&(o[u]=c)}return 0==r.length?o:l(r).then(g(o))}(c,o):c};return A.withIndex=n=>function(t){if(u(t))return function(n,t){const o=n.length,r=[];let u=-1,c=-1;for(;++u<o;){const o=n[u],i=t(o,u,n);if(e(i))return l(v([i],n,t,u)).then(s(a,n,r,u-1,f));i&&(r[++c]=o)}return r}(t,n);throw new TypeError(t+" is not an Array")},A}());
