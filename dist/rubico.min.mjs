/**
 * rubico v1.8.6
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */
const noop=function(){},isPromise=r=>null!=r&&"function"==typeof r.then,funcConcat=(r,t)=>function(...n){const e=r(...n);return isPromise(e)?e.then(t):t(e)},funcConcatSync=(r,t)=>function(...n){return t(r(...n))},objectProto=Object.prototype,nativeObjectToString=objectProto.toString,objectToString=r=>nativeObjectToString.call(r),generatorFunctionTag="[object GeneratorFunction]",isGeneratorFunction=r=>objectToString(r)==generatorFunctionTag,asyncGeneratorFunctionTag="[object AsyncGeneratorFunction]",isAsyncGeneratorFunction=r=>objectToString(r)==asyncGeneratorFunctionTag,pipe=function(r){let t=noop,n=noop;return function(...e){const o=e[0];return"function"!=typeof o||isGeneratorFunction(o)||isAsyncGeneratorFunction(o)?(t==noop&&(t=r.reduce(funcConcat)),t(...e)):(n==noop&&(n=r.reduceRight(funcConcat)),n(...e))}},pipeSync=r=>r.reduce(funcConcatSync);pipe.sync=pipeSync;const isArray=Array.isArray,promiseAll=Promise.all.bind(Promise),funcAll=r=>function(...t){const n=r.length,e=Array(n);let o=-1,c=!1;for(;++o<n;){const n=r[o](...t);isPromise(n)&&(c=!0),e[o]=n}return c?promiseAll(e):e},always=r=>function(){return r},__=Symbol.for("placeholder"),curry3ResolveArg0=(r,t,n)=>function(e){return r(e,t,n)},curry3ResolveArg1=(r,t,n)=>function(e){return r(t,e,n)},curry3ResolveArg2=(r,t,n)=>function(e){return r(t,n,e)},curry3=function(r,t,n,e){return t==__?curry3ResolveArg0(r,n,e):n==__?curry3ResolveArg1(r,t,e):curry3ResolveArg2(r,t,n)},objectSet=function(r,t,n){return r[t]=n,r},funcObjectAll=r=>function(...t){const n={},e=[];for(const o in r){const c=r[o](...t);isPromise(c)?e.push(c.then(curry3(objectSet,n,o,__))):n[o]=c}return 0==e.length?n:promiseAll(e).then(always(n))},curry4ResolveArg0=(r,t,n,e)=>function(o){return r(o,t,n,e)},curry4ResolveArg1=(r,t,n,e)=>function(o){return r(t,o,n,e)},curry4ResolveArg2=(r,t,n,e)=>function(o){return r(t,n,o,e)},curry4ResolveArg3=(r,t,n,e)=>function(o){return r(t,n,e,o)},curry4=function(r,t,n,e,o){return t==__?curry4ResolveArg0(r,n,e,o):n==__?curry4ResolveArg1(r,t,e,o):e==__?curry4ResolveArg2(r,t,n,o):curry4ResolveArg3(r,t,n,e)},asyncFuncAllSeries=async function(r,t,n,e){const o=r.length;for(;++e<o;){const o=r[e](...t);n[e]=isPromise(o)?await o:o}return n},funcAllSeries=r=>function(...t){const n=r.length,e=[];let o=-1;for(;++o<n;){const n=r[o](...t);if(isPromise(n))return n.then(funcConcat(curry3(objectSet,e,o,__),curry4(asyncFuncAllSeries,r,t,__,o)));e[o]=n}return e},fork=r=>isArray(r)?funcAll(r):funcObjectAll(r);fork.series=r=>isArray(r)?funcAllSeries(r):funcObjectAll(r);const objectAssign=Object.assign,assign=function(r){const t=funcObjectAll(r);return function(r){const n=t(r);return isPromise(n)?n.then(curry3(objectAssign,{},r,__)):{...r,...n}}},tapSync=r=>function(...t){return r(...t),t[0]},thunkifyArgs=(r,t)=>function(){return r(...t)},thunkConditional=(r,t,n)=>r?t():n(),tap=r=>function(...t){const n=t[0],e=r(...t);return isPromise(e)?e.then(always(n)):n};tap.sync=tapSync,tap.if=(r,t)=>function(...n){const e=r(...n);if(isPromise(e))return e.then(curry3(thunkConditional,__,thunkifyArgs(tap(t),n),always(n[0])));if(e){const r=t(...n);if(isPromise(r))return r.then(always(n[0]))}return n[0]};const catcherApply=function(r,t,n){return r(t,...n)},tryCatch=(r,t)=>function(...n){try{const e=r(...n);return isPromise(e)?e.catch(curry3(catcherApply,t,__,n)):e}catch(r){return t(r,...n)}},thunkify3=(r,t,n,e)=>function(){return r(t,n,e)},funcConditional=function(r,t,n){const e=r.length-1;for(;(n+=2)<e;){const e=r[n],o=r[n+1],c=e(...t);if(isPromise(c))return c.then(curry3(thunkConditional,__,thunkifyArgs(o,t),thunkify3(funcConditional,r,t,n)));if(c)return o(...t)}return r[n](...t)},switchCase=r=>function(...t){return funcConditional(r,t,-2)},symbolIterator=Symbol.iterator,MappingIterator=(r,t)=>({toString:()=>"[object MappingIterator]",[symbolIterator](){return this},next(){const n=r.next();return n.done?n:{value:t(n.value),done:!1}}}),NextIteration=r=>({value:r,done:!1}),symbolAsyncIterator=Symbol.asyncIterator,MappingAsyncIterator=(r,t)=>({[symbolAsyncIterator](){return this},async next(){const n=await r.next();if(n.done)return n;const e=t(n.value);return isPromise(e)?e.then(NextIteration):{value:e,done:!1}}}),isObject=r=>{if(null==r)return!1;const t=typeof r;return"object"==t||"function"==t},arrayMap=function(r,t){const n=r.length,e=Array(n);let o=-1,c=!1;for(;++o<n;){const n=t(r[o],o,r);isPromise(n)&&(c=!0),e[o]=n}return c?promiseAll(e):e},generatorFunctionMap=(r,t)=>function*(...n){for(const e of r(...n))yield t(e)},asyncGeneratorFunctionMap=function(r,t){return async function*(...n){for await(const e of r(...n))yield t(e)}},curry2ResolveArg0=(r,t)=>function(n){return r(n,t)},curry2ResolveArg1=(r,t)=>function(n){return r(t,n)},curry2=function(r,t,n){return t==__?curry2ResolveArg0(r,n):curry2ResolveArg1(r,t)},reducerMap=(r,t)=>function(n,e){const o=t(e);return isPromise(o)?o.then(curry2(r,n,__)):r(n,o)},callPropUnary=(r,t,n)=>r[t](n),stringMap=function(r,t){const n=arrayMap(r,t);return isPromise(n)?n.then(curry3(callPropUnary,__,"join","")):n.join("")},setMap=function(r,t){const n=new Set,e=[];for(const o of r){const c=t(o,o,r);isPromise(c)?e.push(c.then(curry3(callPropUnary,n,"add",__))):n.add(c)}return 0==e.length?n:promiseAll(e).then(always(n))},callPropBinary=(r,t,n,e)=>r[t](n,e),mapMap=function(r,t){const n=new Map,e=[];for(const[o,c]of r){const i=t(c,o,r);isPromise(i)?e.push(i.then(curry4(callPropBinary,n,"set",o,__))):n.set(o,i)}return 0==e.length?n:promiseAll(e).then(always(n))},promiseObjectAllExecutor=r=>function(t){const n={};let e=0;for(const o in r){const c=r[o];isPromise(c)?(e+=1,c.then((r=>function(o){n[r]=o,e-=1,0==e&&t(n)})(o))):n[o]=c}0==e&&t(n)},promiseObjectAll=r=>new Promise(promiseObjectAllExecutor(r)),objectMap=function(r,t){const n={};let e=!1;for(const o in r){const c=t(r[o],o,r);isPromise(c)&&(e=!0),n[o]=c}return e?promiseObjectAll(n):n},arrayMapSeriesAsync=async function(r,t,n,e){const o=r.length;for(;++e<o;){const o=t(r[e]);n[e]=isPromise(o)?await o:o}return n},arrayMapSeries=function(r,t){const n=r.length,e=Array(n);let o=-1;for(;++o<n;){const n=t(r[o]);if(isPromise(n))return n.then(funcConcat(curry3(objectSet,e,o,__),curry4(arrayMapSeriesAsync,r,t,__,o)));e[o]=n}return e},promiseRace=Promise.race.bind(Promise),arrayMapPoolAsync=async function(r,t,n,e,o,c){const i=r.length;for(;++o<i;){c.size>=n&&await promiseRace(c);const i=t(r[o]);if(isPromise(i)){const r=i.then(tapSync((()=>c.delete(r))));c.add(r),e[o]=r}else e[o]=i}return promiseAll(e)},arrayMapPool=function(r,t,n){const e=r.length,o=Array(e);let c=-1;for(;++c<e;){const e=t(r[c]);if(isPromise(e)){const i=new Set,s=e.then(tapSync((()=>i.delete(s))));return i.add(s),o[c]=s,arrayMapPoolAsync(r,t,n,o,c,i)}o[c]=e}return o},arrayMapWithIndex=function(r,t){const n=r.length,e=Array(n);let o=-1,c=!1;for(;++o<n;){const n=t(r[o],o,r);isPromise(n)&&(c=!0),e[o]=n}return c?promiseAll(e):e},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(r,t)=>hasOwnProperty.call(r,t),objectMapOwn=function(r,t){const n={};let e=!1;for(const o in r)if(hasOwn(r,o)){const c=t(r[o]);isPromise(c)&&(e=!0),n[o]=c}return e?promiseObjectAll(n):n},_curryArity=(r,t,n)=>function(...e){const o=n.length,c=e.length,i=[];let s=-1,u=-1,a=0;for(;++s<o;){const o=n[s];if(o==__&&(u+=1)<c){const r=e[u];r==__&&(a+=1),i.push(r)}else i.push(o);if(i.length==r)return 0==a?t(...i):curryArity(r,t,i)}for(;++u<c;){const n=e[u];if(n==__&&(a+=1),i.push(n),i.length==r)return 0==a?t(...i):curryArity(r,t,i)}return curryArity(r,t,i)},curryArity=function(r,t,n){const e=n.length;if(e<r)return _curryArity(r,t,n);let o=-1;for(;++o<e;){if(n[o]==__)return _curryArity(r,t,n)}return t(...n)},spread2=r=>function([t,n]){return r(t,n)},objectMapEntries=function(r,t){const n={},e=[];for(const o in r){const c=t([o,r[o]]);isPromise(c)?e.push(c.then(spread2(curryArity(3,objectSet,[n])))):n[c[0]]=c[1]}return 0==e.length?n:promiseAll(e).then(always(n))},mapSet=function(r,t,n){return r.set(t,n)},mapMapEntriesForEachCallback=(r,t,n)=>function(e,o){const c=r([o,e]);isPromise(c)?n.push(c.then(spread2(curryArity(3,mapSet,[t])))):t.set(c[0],c[1])},mapMapEntries=function(r,t){const n=new Map,e=[];return r.forEach(mapMapEntriesForEachCallback(t,n,e)),0==e.length?n:promiseAll(e).then(always(n))},map=r=>function(t){return isArray(t)?arrayMap(t,r):"function"==typeof t?isGeneratorFunction(t)?generatorFunctionMap(t,r):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionMap(t,r):reducerMap(t,r):null==t?t:"function"==typeof t.then?t.then(r):"function"==typeof t.map?t.map(r):"string"==typeof t||t.constructor==String?stringMap(t,r):t.constructor==Set?setMap(t,r):t.constructor==Map?mapMap(t,r):"function"==typeof t[symbolIterator]?MappingIterator(t[symbolIterator](),r):"function"==typeof t[symbolAsyncIterator]?MappingAsyncIterator(t[symbolAsyncIterator](),r):t.constructor==Object?objectMap(t,r):r(t)};map.entries=function(r){return function(t){if(null==t)throw new TypeError("value is not an Object or Map");if(t.constructor==Object)return objectMapEntries(t,r);if(t.constructor==Map)return mapMapEntries(t,r);throw new TypeError("value is not an Object or Map")}},map.series=r=>function(t){if(isArray(t))return arrayMapSeries(t,r);throw new TypeError(`${t} is not an Array`)},map.pool=(r,t)=>function(n){if(isArray(n))return arrayMapPool(n,t,r);throw new TypeError(`${n} is not an Array`)},map.withIndex=r=>function(t){if(isArray(t))return arrayMapWithIndex(t,r);throw new TypeError(`${t} is not an Array`)},map.own=r=>function(t){if(isObject(t)&&!isArray(t))return objectMapOwn(t,r);throw new TypeError(`${t} is not an Object`)};const FilteringIterator=(r,t)=>({[symbolIterator](){return this},next(){let n=r.next();for(;!n.done;){const{value:e}=n;if(t(e))return{value:e,done:!1};n=r.next()}return n}}),FilteringAsyncIterator=(r,t)=>({[symbolAsyncIterator](){return this},async next(){let n=await r.next();for(;!n.done;){const{value:e}=n,o=t(e);if(isPromise(o)?await o:o)return{value:e,done:!1};n=await r.next()}return n}}),arrayExtendMap=function(r,t,n,e){const o=t.length;let c=r.length-1;for(;++e<o;)r[++c]=n(t[e],e,r);return r},arrayFilterByConditions=function(r,t,n,e){const o=r.length;let c=-1;for(;++n<o;)e[++c]&&t.push(r[n]);return t},arrayFilter=function(r,t){const n=r.length,e=[];let o=-1,c=-1;for(;++o<n;){const n=r[o],i=t(n);if(isPromise(i))return promiseAll(arrayExtendMap([i],r,t,o)).then(curry4(arrayFilterByConditions,r,e,o-1,__));i&&(e[++c]=n)}return e},generatorFunctionFilter=(r,t)=>function*(...n){yield*FilteringIterator(r(...n),t)},asyncGeneratorFunctionFilter=(r,t)=>async function*(...n){yield*FilteringAsyncIterator(r(...n),t)},thunkify2=(r,t,n)=>function(){return r(t,n)},reducerFilter=(r,t)=>function(n,e){const o=t(e);return isPromise(o)?o.then(curry3(thunkConditional,__,(c=r,i=n,s=e,function(){return c(i,s)}),always(n))):o?r(n,e):n;var c,i,s},stringFilter=function(r,t){const n=arrayFilter(r,t);return isPromise(n)?n.then(curry3(callPropUnary,__,"join","")):n.join("")},thunkify1=(r,t)=>function(){return r(t)},setFilter=function(r,t){const n=new Set,e=n.add.bind(n),o=[];for(const c of r){const i=t(c,c,r);isPromise(i)?o.push(i.then(curry3(thunkConditional,__,thunkify1(e,c),noop))):i&&n.add(c)}return 0==o.length?n:promiseAll(o).then(always(n))},thunkify4=(r,t,n,e,o)=>function(){return r(t,n,e,o)},mapFilter=function(r,t){const n=new Map,e=[];for(const[o,c]of r){const i=t(c,o,r);isPromise(i)?e.push(i.then(curry3(thunkConditional,__,thunkify4(callPropBinary,n,"set",o,c),noop))):i&&n.set(o,c)}return 0==e.length?n:promiseAll(e).then(always(n))},objectSetIf=function(r,t,n,e){e&&(r[t]=n)},objectFilter=function(r,t){const n={},e=[];for(const o in r){const c=r[o],i=t(c,o,r);isPromise(i)?e.push(i.then(curry4(objectSetIf,n,o,r[o],__))):i&&(n[o]=c)}return 0==e.length?n:promiseAll(e).then(always(n))},arrayExtendMapWithIndex=function(r,t,n,e){const o=t.length;let c=r.length-1;for(;++e<o;)r[++c]=n(t[e],e,t);return r},arrayFilterWithIndex=function(r,t){const n=r.length,e=[];let o=-1,c=-1;for(;++o<n;){const n=r[o],i=t(n,o,r);if(isPromise(i))return promiseAll(arrayExtendMapWithIndex([i],r,t,o)).then(curry4(arrayFilterByConditions,r,e,o-1,__));i&&(e[++c]=n)}return e},filter=r=>function(t){return isArray(t)?arrayFilter(t,r):"function"==typeof t?isGeneratorFunction(t)?generatorFunctionFilter(t,r):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionFilter(t,r):reducerFilter(t,r):null==t?t:"string"==typeof t||t.constructor==String?stringFilter(t,r):t.constructor==Set?setFilter(t,r):t.constructor==Map?mapFilter(t,r):"function"==typeof t.filter?t.filter(r):"function"==typeof t[symbolIterator]?FilteringIterator(t[symbolIterator](),r):"function"==typeof t[symbolAsyncIterator]?FilteringAsyncIterator(t[symbolAsyncIterator](),r):t.constructor==Object?objectFilter(t,r):t};filter.withIndex=r=>function(t){if(isArray(t))return arrayFilterWithIndex(t,r);throw new TypeError(`${t} is not an Array`)};const curryArgs3ResolveArgs0=(r,t,n)=>function(...e){return r(e,t,n)},curryArgs3ResolveArgs1=(r,t,n)=>function(...e){return r(t,e,n)},curryArgs3ResolveArgs2=(r,t,n)=>function(...e){return r(t,n,e)},curryArgs3=function(r,t,n,e){return t==__?curryArgs3ResolveArgs0(r,n,e):n==__?curryArgs3ResolveArgs1(r,t,e):curryArgs3ResolveArgs2(r,t,n)},objectValues=Object.values,iteratorReduceAsync=async function(r,t,n){let e=r.next();if(e.done)return n;for(;!e.done;)n=t(n,e.value),isPromise(n)&&(n=await n),e=r.next();return n},iteratorReduce=function(r,t,n){let e=r.next();if(e.done)return n;for(void 0===n&&(n=e.value,e=r.next());!e.done;){if(n=t(n,e.value),isPromise(n))return n.then(curry3(iteratorReduceAsync,r,t,__));e=r.next()}return n},asyncIteratorReduce=async function(r,t,n){let e=await r.next();if(e.done)return n;for(void 0===n&&(n=e.value,e=await r.next());!e.done;)n=await t(n,e.value),e=await r.next();return n},arrayReduceAsync=async function(r,t,n,e){const o=r.length;for(;++e<o;)n=t(n,r[e],e,r),isPromise(n)&&(n=await n);return n},arrayReduce=function(r,t,n){const e=r.length;let o=-1;for(void 0===n&&(n=r[++o]);++o<e;)if(n=t(n,r[o],o,r),isPromise(n))return n.then(curry4(arrayReduceAsync,r,t,__,o));return n},curry5ResolveArg0=(r,t,n,e,o)=>function(c){return r(c,t,n,e,o)},curry5ResolveArg1=(r,t,n,e,o)=>function(c){return r(t,c,n,e,o)},curry5ResolveArg2=(r,t,n,e,o)=>function(c){return r(t,n,c,e,o)},curry5ResolveArg3=(r,t,n,e,o)=>function(c){return r(t,n,e,c,o)},curry5ResolveArg4=(r,t,n,e,o)=>function(c){return r(t,n,e,o,c)},curry5=function(r,t,n,e,o,c){return t==__?curry5ResolveArg0(r,n,e,o,c):n==__?curry5ResolveArg1(r,t,e,o,c):e==__?curry5ResolveArg2(r,t,n,o,c):o==__?curry5ResolveArg3(r,t,n,e,c):curry5ResolveArg4(r,t,n,e,o)},objectKeys=Object.keys,objectGetFirstKey=function(r){for(const t in r)return t},objectReduceAsync=async function(r,t,n,e,o){const c=e.length;for(;++o<c;){const c=e[o];n=t(n,r[c],c,r),isPromise(n)&&(n=await n)}return n},objectReduce=function(r,t,n){const e=objectKeys(r),o=e.length;let c=-1;for(void 0===n&&(n=r[e[++c]]);++c<o;){const o=e[c];if(n=t(n,r[o],o,r),isPromise(n))return n.then((i=objectReduceAsync,u=t,a=__,l=e,f=c,(s=r)==__?curry5ResolveArg0(i,u,a,l,f):u==__?curry5ResolveArg1(i,s,a,l,f):a==__?curry5ResolveArg2(i,s,u,l,f):l==__?curry5ResolveArg3(i,s,u,a,f):curry5ResolveArg4(i,s,u,a,l)))}var i,s,u,a,l,f;return n},mapReduceAsync=async function(r,t,n,e){for(const[o,c]of e)n=t(n,c,o,r),isPromise(n)&&(n=await n);return n},mapReduce=function(r,t,n){const e=r.entries();if(void 0===n){const r=e.next();if(r.done)return n;n=r.value[1]}for(const[o,c]of e)if(n=t(n,c,o,r),isPromise(n))return n.then(curry4(mapReduceAsync,r,t,__,e));return n},generatorFunctionReduce=(r,t,n)=>funcConcatSync(r,curry3(iteratorReduce,__,t,n)),asyncGeneratorFunctionReduce=(r,t,n)=>funcConcatSync(r,curry3(asyncIteratorReduce,__,t,n)),reducerConcat=(r,t)=>function(n,e){const o=r(n,e);return isPromise(o)?o.then(curry2(t,__,e)):t(o,e)},genericReduce=function(r,t,n){const e=r[0];return isArray(e)?arrayReduce(e,t,n):"function"==typeof e?isGeneratorFunction(e)?generatorFunctionReduce(e,t,n):isAsyncGeneratorFunction(e)?asyncGeneratorFunctionReduce(e,t,n):curryArgs3(genericReduce,__,1==r.length?reducerConcat(t,e):r.reduce(reducerConcat,t),n):null==e?void 0===n?curry2(t,e,__):t(n,e):e.constructor==Map?mapReduce(e,t,n):"function"==typeof e[symbolIterator]?iteratorReduce(e[symbolIterator](),t,n):"function"==typeof e[symbolAsyncIterator]?asyncIteratorReduce(e[symbolAsyncIterator](),t,n):"function"==typeof e.reduce?e.reduce(t,n):"function"==typeof e.chain?e.chain(curry2(t,n,__)):"function"==typeof e.flatMap?e.flatMap(curry2(t,n,__)):e.constructor==Object?objectReduce(e,t,n):void 0===n?curry2(t,e,__):t(n,e)},reduce=function(r,t){return"function"==typeof t?function(...n){const e=t(...n);return isPromise(e)?e.then(curry3(genericReduce,n,r,__)):genericReduce(n,r,e)}:curryArgs3(genericReduce,__,r,t)},isBinary=ArrayBuffer.isView,add=(r,t)=>r+t,isArrayLike=function(r){return null!=r&&r.length>0},_arrayExtend=function(r,t){const n=r.length,e=t.length;let o=-1;for(;++o<e;)r[n+o]=t[o];return r},arrayExtend=function(r,t){return null!=(n=t)&&n.length>0?_arrayExtend(r,t):(r.push(t),r);var n},globalThisHasBuffer="function"==typeof Buffer,bufferAlloc=globalThisHasBuffer?Buffer.alloc:noop,_binaryExtend=function(r,t){const n=r.length,e=globalThisHasBuffer&&r.constructor==Buffer?bufferAlloc(n+t.length):new r.constructor(n+t.length);return e.set(r),e.set(t,n),e},binaryExtend=function(r,t){return isArray(t)||isBinary(t)?_binaryExtend(r,t):_binaryExtend(r,[t])},isNodeReadStream=r=>null!=r&&"function"==typeof r.pipe,__streamWrite=r=>function(t,n,e){return r.write(t,n,e),r},_streamExtendExecutor=(r,t)=>function(n,e){t.on("data",__streamWrite(r)),t.on("end",thunkify1(n,r)),t.on("error",e)},_streamExtend=(r,t)=>new Promise(_streamExtendExecutor(r,t)),streamExtend=function(r,t){return null!=(n=t)&&"function"==typeof n.pipe?_streamExtend(r,t):(r.write(t),r);var n},setExtend=function(r,t){if(null!=t&&t.constructor==Set){for(const n of t)r.add(n);return r}return r.add(t)},callConcat=function(r,t){return r.concat(t)},identityTransform=function(r,t,n){const e=genericReduce(r,t(noop),null);return isPromise(e)?e.then(always(n)):n},genericTransform=function(r,t,n){if(isArray(n))return genericReduce(r,t(arrayExtend),n);if(isBinary(n)){const e=genericReduce(r,t(arrayExtend),[]);return isPromise(e)?e.then(curry2(binaryExtend,n,__)):binaryExtend(n,e)}if(null==n)return identityTransform(r,t,n);const e=n.constructor;return"string"==typeof n||e==String?genericReduce(r,t(add),n):"function"==typeof n.concat?genericReduce(r,t(callConcat),n):"function"==typeof n.write?genericReduce(r,t(streamExtend),n):e==Set?genericReduce(r,t(setExtend),n):e==Object?genericReduce(r,t(objectAssign),n):identityTransform(r,t,n)},transform=function(r,t){return"function"==typeof t?function(...n){const e=t(...n);return isPromise(e)?e.then(curry3(genericTransform,n,r,__)):genericTransform(n,r,e)}:function(...n){return genericTransform(n,r,t)}},arrayPush=function(r,t){return r.push(t),r},FlatMappingIterator=function(r,t){let n=[],e=0;return{[symbolIterator](){return this},next(){if(e<n.length){const r=n[e];return e+=1,{value:r,done:!1}}const o=r.next();if(o.done)return o;const c=genericReduce([t(o.value)],arrayPush,[]);return c.length>1&&(n=c,e=1),{value:c[0],done:!1}}}},once=function(r){let t=!1;return function(...n){if(!t)return t=!0,r(...n)}},promiseAnyRejectOnce=function(r){return new Promise(((t,n)=>{const e=once(t),o=once(n);r.forEach((r=>{r.then(e,o)}))}))},FlatMappingAsyncIterator=function(r,t){const n=[],e=new Set;return{isAsyncIteratorDone:!1,[symbolAsyncIterator](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){for(;!this.isAsyncIteratorDone||n.length>0||e.size>0;){const{value:o,done:c}=await r.next();if(c)this.isAsyncIteratorDone=c;else{const r=t(o);if(isPromise(r)){const t=r.then(curryArgs3(genericReduce,__,arrayPush,n)).then((()=>e.delete(t)));e.add(t)}else{const t=genericReduce([r],arrayPush,n);if(isPromise(t)){const r=t.then((()=>e.delete(r)));e.add(r)}}}if(n.length>0)return{value:n.shift(),done:!1};e.size>0&&await promiseAnyRejectOnce(e)}return{value:void 0,done:!0}}}},getArg1=(r,t)=>t,identity=r=>r,asyncIteratorForEach=async function(r,t){const n=[];for await(const e of r){const r=t(e);isPromise(r)&&n.push(r)}return 0==n.length?r:promiseAll(n).then(always(r))},arrayFlatten=function(r){const t=r.length,n=[],e=[];let o=-1;for(;++o<t;){const t=r[o];if(isArray(t)){const r=t.length;let n=-1;for(;++n<r;)e.push(t[n])}else if(null==t)e.push(t);else if("function"==typeof t.then)n.push(t.then(curry2(arrayPush,e,__)));else if("function"==typeof t[symbolIterator])for(const r of t)e.push(r);else if("function"==typeof t[symbolAsyncIterator])n.push(asyncIteratorForEach(t[symbolAsyncIterator](),curry2(arrayPush,e,__)));else if("function"==typeof t.chain){const r=t.chain(identity);isPromise(r)?n.push(r.then(curry2(arrayPush,e,__))):e.push(r)}else if("function"==typeof t.flatMap){const r=t.flatMap(identity);isPromise(r)?n.push(r.then(curry2(arrayPush,e,__))):e.push(r)}else if("function"==typeof t.reduce){const r=t.reduce(funcConcatSync(getArg1,curry2(arrayPush,e,__)),null);isPromise(r)&&n.push(r)}else if(t.constructor==Object)for(const r in t)e.push(t[r]);else e.push(t)}return 0==n.length?e:promiseAll(n).then(always(e))},arrayFlatMap=function(r,t){const n=arrayMap(r,t);return isPromise(n)?n.then(arrayFlatten):arrayFlatten(n)},objectFlatten=function(r){const t=[],n={},e=curry2(objectAssign,n,__),o=funcConcatSync(getArg1,e);for(const c in r){const i=r[c];if(null!=i)if("function"==typeof i[symbolIterator])for(const r of i)objectAssign(n,r);else if("function"==typeof i[symbolAsyncIterator])t.push(asyncIteratorForEach(i[symbolAsyncIterator](),e));else if("function"==typeof i.chain){const r=i.chain(identity);isPromise(r)?t.push(r.then(e)):objectAssign(n,r)}else if("function"==typeof i.flatMap){const r=i.flatMap(identity);isPromise(r)?t.push(r.then(e)):e(r)}else if("function"==typeof i.reduce){const r=i.reduce(o,null);isPromise(r)&&t.push(r)}else objectAssign(n,i)}return 0==t.length?n:promiseAll(t).then((()=>n))},objectFlatMap=function(r,t){const n=objectMap(r,t);return isPromise(n)?n.then(objectFlatten):objectFlatten(n)},setFlatten=function(r){r.size;const t=[],n=new Set,e=(r,t)=>n.add(t),o=curry3(callPropUnary,n,"add",__);for(const c of r)if(isArray(c)){const r=c.length;let t=-1;for(;++t<r;)n.add(c[t])}else if(null==c)n.add(c);else if("function"==typeof c[symbolIterator])for(const r of c)n.add(r);else if("function"==typeof c[symbolAsyncIterator])t.push(asyncIteratorForEach(c[symbolAsyncIterator](),o));else if("function"==typeof c.chain){const r=c.chain(identity);isPromise(r)?t.push(r.then(o)):n.add(r)}else if("function"==typeof c.flatMap){const r=c.flatMap(identity);isPromise(r)?t.push(r.then(o)):n.add(r)}else if("function"==typeof c.reduce){const r=c.reduce(e,null);isPromise(r)&&t.push(r)}else if(c.constructor==Object)for(const r in c)n.add(c[r]);else n.add(c);return 0==t.length?n:promiseAll(t).then((()=>n))},setFlatMap=function(r,t){const n=setMap(r,t);return isPromise(n)?n.then(setFlatten):setFlatten(n)},arrayJoin=(r,t)=>r.join(t),arrayFlattenToString=funcConcat(arrayFlatten,curry2(arrayJoin,__,"")),stringFlatMap=function(r,t){const n=arrayMap(r,t);return isPromise(n)?n.then(arrayFlattenToString):arrayFlattenToString(n)},streamWrite=function(r,t,n,e){return r.write(t,n,e),r},streamFlatExtend=async function(r,t){const n=curry2(streamWrite,r,__),e=funcConcatSync(getArg1,n),o=[];if(isArray(t)){const n=t.length;let e=-1;for(;++e<n;)r.write(t[e])}else if(null==t)r.write(t);else if("function"==typeof t[symbolIterator])for(const n of t)r.write(n);else if("function"==typeof t[symbolAsyncIterator])o.push(asyncIteratorForEach(t[symbolAsyncIterator](),n));else if("function"==typeof t.chain){const e=t.chain(identity);isPromise(e)?o.push(e.then(n)):r.write(e)}else if("function"==typeof t.flatMap){const e=t.flatMap(identity);isPromise(e)?o.push(e.then(n)):r.write(e)}else if("function"==typeof t.reduce){const r=t.reduce(e,null);isPromise(r)&&o.push(r)}else if(t.constructor==Object)for(const n in t)r.write(t[n]);else r.write(t);return 0==o.length?r:promiseAll(o).then(always(r))},streamFlatMap=async function(r,t){const n=new Set;for await(const e of r){const o=t(e);if(isPromise(o)){const t=o.then(curry2(streamFlatExtend,r,__)).then((()=>n.delete(t)));n.add(t)}else{const t=streamFlatExtend(r,o);if(isPromise(t)){const r=t.then((()=>n.delete(r)));n.add(r)}}}return await promiseAll(n),r},arrayJoinToBinary=function(r,t){const n=r.length;let e=-1,o=t;for(;++e<n;)o=binaryExtend(o,r[e]);return o},arrayFlattenToBinary=function(r,t){const n=arrayFlatten(r);return isPromise(n)?n.then(curry2(arrayJoinToBinary,__,t)):arrayJoinToBinary(n,t)},binaryFlatMap=function(r,t){const n=arrayMap(r,t),e=globalThisHasBuffer&&r.constructor==Buffer?bufferAlloc(0):new r.constructor(0);return isPromise(n)?n.then(curry2(arrayFlattenToBinary,__,e)):arrayFlattenToBinary(n,e)},reducerFlatMap=(r,t)=>function(n,e){const o=t(e);return isPromise(o)?o.then(curryArgs3(genericReduce,__,r,n)):genericReduce([o],r,n)},generatorFunctionFlatMap=(r,t)=>function*(...n){yield*FlatMappingIterator(r(...n),t)},asyncGeneratorFunctionFlatMap=(r,t)=>async function*(...n){yield*FlatMappingAsyncIterator(r(...n),t)},flatMap=r=>function(t){if(isArray(t))return arrayFlatMap(t,r);if("function"==typeof t)return isGeneratorFunction(t)?generatorFunctionFlatMap(t,r):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionFlatMap(t,r):reducerFlatMap(t,r);if(isBinary(t))return binaryFlatMap(t,r);if(null==t)return r(t);if("function"==typeof t.then)return t.then(r);if("function"==typeof t.next)return symbolIterator in t?FlatMappingIterator(t,r):FlatMappingAsyncIterator(t,r);if("function"==typeof t.chain)return t.chain(r);if("function"==typeof t.flatMap)return t.flatMap(r);if("function"==typeof t[symbolAsyncIterator]&&"function"==typeof t.write)return streamFlatMap(t,r);const n=t.constructor;return n==Object?objectFlatMap(t,r):n==Set?setFlatMap(t,r):"string"==typeof t||n==String?stringFlatMap(t,r):r(t)},SelfReferencingPromise=function(r){const t=r.then((r=>[r,t]));return t},asyncArrayAny=async function(r,t,n,e){const o=r.length;for(;++n<o;){const o=t(r[n]);if(isPromise(o))e.add(SelfReferencingPromise(o));else if(o)return!0}for(;e.size>0;){const[r,t]=await promiseRace(e);if(e.delete(t),r)return!0}return!1},arrayAny=function(r,t){const n=r.length;let e=-1;for(;++e<n;){const n=t(r[e]);if(isPromise(n))return asyncArrayAny(r,t,e,new Set([SelfReferencingPromise(n)]));if(n)return!0}return!1},asyncIteratorAny=async function(r,t,n,e=20){let o=r.next();for(isPromise(o)&&(o=await o);!o.done;){if(n.size>=e){const[r,t]=await promiseRace(n);if(n.delete(t),r)return!0}const c=t(o.value);if(isPromise(c))n.add(SelfReferencingPromise(c));else if(c)return!0;o=r.next(),isPromise(o)&&(o=await o)}for(;n.size>0;){const[r,t]=await promiseRace(n);if(n.delete(t),r)return!0}return!1},iteratorAny=function(r,t){for(const n of r){const e=t(n);if(isPromise(e))return asyncIteratorAny(r,t,new Set([SelfReferencingPromise(e)]));if(e)return!0}return!1},reducerAnySync=r=>function(t,n){return!!t||r(n)},reducerAny=r=>function(t,n){return!0===t?t:isPromise(t)?t.then(curry2(reducerAnySync(r),__,n)):!!t||r(n)},any=r=>function(t){return isArray(t)?arrayAny(t,r):null==t?r(t):"function"==typeof t[symbolIterator]?iteratorAny(t[symbolIterator](),r):"function"==typeof t[symbolAsyncIterator]?asyncIteratorAny(t[symbolAsyncIterator](),r,new Set):"function"==typeof t.reduce?t.reduce(reducerAny(r),!1):t.constructor==Object?arrayAny(objectValues(t),r):r(t)},arrayAll=function(r,t){const n=r.length,e=[];let o=-1;for(;++o<n;){const n=t(r[o]);if(isPromise(n))e.push(n);else if(!n)return!1}return 0==e.length||promiseAll(e).then(curry3(callPropUnary,__,"every",Boolean))},iteratorAll=function(r,t){const n=[];for(const e of r){const r=t(e);if(isPromise(r))n.push(r);else if(!r)return!1}return 0==n.length||promiseAll(n).then(curry3(callPropUnary,__,"every",Boolean))},asyncIteratorAll=async function(r,t,n,e=20){let o=await r.next();for(;!o.done;){if(n.size>=e){const[r,t]=await promiseRace(n);if(n.delete(t),!r)return!1}const c=t(o.value);if(isPromise(c))n.add(SelfReferencingPromise(c));else if(!c)return!1;o=await r.next()}for(;n.size>0;){const[r,t]=await promiseRace(n);if(n.delete(t),!r)return!1}return!0},reducerAllSync=(r,t,n)=>!!t&&r(n),reducerAll=r=>function(t,n){return!1!==t&&(isPromise(t)?t.then(curry3(reducerAllSync,r,__,n)):!!t&&r(n))},all=r=>function(t){return isArray(t)?arrayAll(t,r):null==t?r(t):"function"==typeof t[symbolIterator]?iteratorAll(t[symbolIterator](),r):"function"==typeof t[symbolAsyncIterator]?asyncIteratorAll(t[symbolAsyncIterator](),r,new Set):"function"==typeof t.reduce?t.reduce(reducerAll(r),!0):t.constructor==Object?arrayAll(objectValues(t),r):r(t)},asyncAnd=async function(r,t,n){const e=r.length;for(;++n<e;){let e=r[n](t);if(isPromise(e)&&(e=await e),!e)return!1}return!0},and=r=>function(t){if(null!=t&&"function"==typeof t.and)return t.and(r);const n=r.length;let e=-1;for(;++e<n;){const n=r[e](t);if(isPromise(n))return n.then(curry3(thunkConditional,__,thunkify3(asyncAnd,r,t,e),always(!1)));if(!n)return!1}return!0},asyncOr=async function(r,t){const n=r.length;let e=-1;for(;++e<n;){let n=r[e](t);if(isPromise(n)&&(n=await n),n)return!0}return!1},_asyncOrInterlude=(r,t,n)=>!!n||asyncOr(r,t),or=r=>function(t){if(null!=t&&"function"==typeof t.or)return t.or(r);const n=r.length;let e=-1;for(;++e<n;){const n=r[e](t);if(isPromise(n))return n.then(curry3(_asyncOrInterlude,r,t,__));if(n)return!0}return!1},_not=r=>!r,not=r=>function(t){if(null!=t&&"function"==typeof t.not)return t.not(r);const n=r(t);return isPromise(n)?n.then(_not):!n},notSync=r=>function(...t){return!r(...t)};not.sync=notSync;const sameValueZero=function(r,t){return r===t||r!=r&&t!=t},eq=function(r,t){const n="function"==typeof r,e="function"==typeof t;return n&&e?function(n){const e=r(n),o=t(n),c=isPromise(e),i=isPromise(o);return c&&i?promiseAll([e,o]).then(spread2(sameValueZero)):c?e.then(curry2(sameValueZero,__,o)):i?o.then(curry2(sameValueZero,e,__)):sameValueZero(e,o)}:n?function(n){const e=r(n);return isPromise(e)?e.then(curry2(sameValueZero,__,t)):sameValueZero(e,t)}:e?function(n){const e=t(n);return isPromise(e)?e.then(curry2(sameValueZero,r,__)):sameValueZero(r,e)}:function(n){return null!=n&&"function"==typeof n.eq?n.eq(r,t):sameValueZero(r,t)}},greaterThan=(r,t)=>r>t,gt=function(r,t){const n="function"==typeof r,e="function"==typeof t;return n&&e?function(n){const e=r(n),o=t(n),c=isPromise(e),i=isPromise(o);return c&&i?promiseAll([e,o]).then(spread2(greaterThan)):c?e.then(curry2(greaterThan,__,o)):i?o.then(curry2(greaterThan,e,__)):e>o}:n?function(n){const e=r(n);return isPromise(e)?e.then(curry2(greaterThan,__,t)):e>t}:e?function(n){const e=t(n);return isPromise(e)?e.then(curry2(greaterThan,r,__)):r>e}:function(n){return null!=n&&"function"==typeof n.eq?n.gt(r,t):r>t}},lessThan=(r,t)=>r<t,lt=function(r,t){const n="function"==typeof r,e="function"==typeof t;return n&&e?function(n){const e=r(n),o=t(n),c=isPromise(e),i=isPromise(o);return c&&i?promiseAll([e,o]).then(spread2(lessThan)):c?e.then(curry2(lessThan,__,o)):i?o.then(curry2(lessThan,e,__)):e<o}:n?function(n){const e=r(n);return isPromise(e)?e.then(curry2(lessThan,__,t)):e<t}:e?function(n){const e=t(n);return isPromise(e)?e.then(curry2(lessThan,r,__)):r<e}:function(n){return null!=n&&"function"==typeof n.eq?n.lt(r,t):r<t}},greaterThanOrEqual=(r,t)=>r>=t,gte=function(r,t){const n="function"==typeof r,e="function"==typeof t;return n&&e?function(n){const e=r(n),o=t(n),c=isPromise(e),i=isPromise(o);return c&&i?promiseAll([e,o]).then(spread2(greaterThanOrEqual)):c?e.then(curry2(greaterThanOrEqual,__,o)):i?o.then(curry2(greaterThanOrEqual,e,__)):e>=o}:n?function(n){const e=r(n);return isPromise(e)?e.then(curry2(greaterThanOrEqual,__,t)):e>=t}:e?function(n){const e=t(n);return isPromise(e)?e.then(curry2(greaterThanOrEqual,r,__)):r>=e}:function(n){return null!=n&&"function"==typeof n.eq?n.gte(r,t):r>=t}},lessThanOrEqual=(r,t)=>r<=t,lte=function(r,t){const n="function"==typeof r,e="function"==typeof t;return n&&e?function(n){const e=r(n),o=t(n),c=isPromise(e),i=isPromise(o);return c&&i?promiseAll([e,o]).then(spread2(lessThanOrEqual)):c?e.then(curry2(lessThanOrEqual,__,o)):i?o.then(curry2(lessThanOrEqual,e,__)):e<=o}:n?function(n){const e=r(n);return isPromise(e)?e.then(curry2(lessThanOrEqual,__,t)):e<=t}:e?function(n){const e=t(n);return isPromise(e)?e.then(curry2(lessThanOrEqual,r,__)):r<=e}:function(n){return null!=n&&"function"==typeof n.eq?n.lte(r,t):r<=t}},memoizeCappedUnary=function(r,t){const n=new Map,e=function(e){if(n.has(e))return n.get(e);const o=r(e);return n.set(e,o),n.size>t&&n.clear(),o};return e.cache=n,e},pathDelimiters=/[.|[|\]]+/,parsePropertyPath=function(r){const t=r.length-1,n="["==r[0],e="]"==r[t];return n&&e?r.slice(1,t).split(pathDelimiters):n?r.slice(1).split(pathDelimiters):e?r.slice(0,t).split(pathDelimiters):r.split(pathDelimiters)},memoizedCappedParsePropertyPath=memoizeCappedUnary(parsePropertyPath,500),propertyPathToArray=r=>isArray(r)?r:"string"==typeof r?memoizedCappedParsePropertyPath(r):[r],getByPath=function(r,t){const n=propertyPathToArray(t),e=n.length;let o=-1,c=r;for(;++o<e;)if(c=c[n[o]],null==c)return;return c},get=(r,t)=>function(n){const e=null==n?void 0:getByPath(n,r);return void 0===e?"function"==typeof t?t(n):t:e},setByPath=function(r,t,n){if(!isObject(r))return r;const e=propertyPathToArray(n),o=e.length,c=o-1,i={...r};let s=i,u=-1;for(;++u<o;){const r=e[u];if(u==c)s[r]=t;else{const t=s[r],n=isArray(t)?t.slice():{...t};s[r]=n,s=n}}return i},set=(r,t)=>function(n){return setByPath(n,t,r)},pick=r=>function(t){if(null==t)return t;const n=r.length;let e={},o=-1;for(;++o<n;){const n=r[o],c=getByPath(t,n);null!=c&&(e=setByPath(e,c,n))}return e},deleteByPath=function(r,t){if(null==r)return;const n=propertyPathToArray(t),e=n.length-1;let o=-1,c=r;for(;++o<e;)if(c=c[n[o]],null==c)return;const i=n[o];null!=c&&i in c&&delete c[i]},objectCopyDeep=function(r){const t={};for(const n in r){const e=r[n];isArray(e)?t[n]=arrayCopyDeep(e):null!=e&&e.constructor==Object?t[n]=objectCopyDeep(e):t[n]=e}return t},arrayCopyDeep=function(r){const t=r.length,n=[];let e=-1;for(;++e<t;){const t=r[e];isArray(t)?n[e]=arrayCopyDeep(t):null!=t&&t.constructor==Object?n[e]=objectCopyDeep(t):n[e]=t}return n},copyDeep=function(r){return isArray(r)?arrayCopyDeep(r):null==r?r:r.constructor==Object?objectCopyDeep(r):r},omit=r=>function(t){const n=r.length,e=isArray(o=t)?arrayCopyDeep(o):null==o?o:o.constructor==Object?objectCopyDeep(o):o;var o;let c=-1;for(;++c<n;)deleteByPath(e,r[c]);return e},thunkify=(r,...t)=>function(){return r(...t)},curry=(r,...t)=>curryArity(r.length,r,t);curry.arity=function(r,t,...n){return curryArity(r,t,n)};const rubico={pipe:pipe,tap:tap,switchCase:switchCase,tryCatch:tryCatch,fork:fork,assign:assign,get:get,set:set,pick:pick,omit:omit,map:map,filter:filter,reduce:reduce,transform:transform,flatMap:flatMap,and:and,or:or,not:not,any:any,all:all,eq:eq,gt:gt,lt:lt,gte:gte,lte:lte,thunkify:thunkify,always:always,curry:curry,__:__};export{pipe,tap,switchCase,tryCatch,fork,assign,get,set,pick,omit,map,filter,reduce,transform,flatMap,and,or,not,any,all,eq,gt,lt,gte,lte,thunkify,always,curry,__};export default rubico;
