/**
 * rubico v1.6.18
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.flatMap=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Array.isArray,t=Object.values,e=Object.prototype.toString,o=n=>e.call(n),f=n=>"[object GeneratorFunction]"==o(n),r=n=>"[object AsyncGeneratorFunction]"==o(n),u=Symbol.for("placeholder"),c=function(n,t,e,o){return t==u?((n,t,e)=>function(o){return n(o,t,e)})(n,e,o):e==u?((n,t,e)=>function(o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(o){return n(t,e,o)})(n,t,e)},i=n=>null!=n&&"function"==typeof n.then,s=async function(n,t,e){let o=n.next();if(o.done)return e;for(;!o.done;)e=t(e,o.value),i(e)&&(e=await e),o=n.next();return e},l=function(n,t,e){let o=n.next();if(o.done)return e;for(void 0===e&&(e=o.value,o=n.next());!o.done;){if(e=t(e,o.value),i(e))return e.then(c(s,n,t,u));o=n.next()}return e},a=async function(n,t,e){let o=await n.next();if(o.done)return e;for(void 0===e&&(e=o.value,o=await n.next());!o.done;)e=await t(e,o.value),o=await n.next();return e},h=Symbol.iterator,p=Symbol.asyncIterator,d=function(n,t,e){return t==u?((n,t)=>function(e){return n(e,t)})(n,e):((n,t)=>function(e){return n(t,e)})(n,t)},y=function(n,t,e,o){return t==u?((n,t,e)=>function(...o){return n(o,t,e)})(n,e,o):e==u?((n,t,e)=>function(...o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(...o){return n(t,e,o)})(n,t,e)},w=async function(n,t,e,o){const f=n.length;for(;++o<f;)e=t(e,n[o]),i(e)&&(e=await e);return e},g=function(n,t,e){const o=n.length;let f=-1;for(void 0===e&&(e=n[++f]);++f<o;)if(e=t(e,n[f]),i(e))return e.then((r=w,s=t,l=u,a=f,(c=n)==u?((n,t,e,o)=>function(f){return n(f,t,e,o)})(r,s,l,a):s==u?((n,t,e,o)=>function(f){return n(t,f,e,o)})(r,c,l,a):l==u?((n,t,e,o)=>function(f){return n(t,e,f,o)})(r,c,s,a):((n,t,e,o)=>function(f){return n(t,e,o,f)})(r,c,s,l)));var r,c,s,l,a;return e},b=(n,t)=>function(...e){return t(n(...e))},v=(n,t)=>function(e,o){const f=n(e,o);return i(f)?f.then(d(t,u,o)):t(f,o)},j=function(e,o,i){const s=e[0];return n(s)?g(s,o,i):"function"==typeof s?f(s)?((n,t,e)=>b(n,c(l,u,t,e)))(s,o,i):r(s)?((n,t,e)=>b(n,c(a,u,t,e)))(s,o,i):y(j,u,1==e.length?v(o,s):e.reduce(v,o),i):null==s?void 0===i?d(o,s,u):o(i,s):"function"==typeof s[h]?l(s[h](),o,i):"function"==typeof s[p]?a(s[p](),o,i):"function"==typeof s.reduce?s.reduce(o,i):"function"==typeof s.chain?s.chain(d(o,i,u)):"function"==typeof s.flatMap?s.flatMap(d(o,i,u)):s.constructor==Object?g(t(s),o,i):void 0===i?d(o,s,u):o(i,s)},M=function(n,t){return n.push(t),n},x=function(n,t){let e=[],o=0;return{[h](){return this},next(){if(o<e.length){const n=e[o];return o+=1,{value:n,done:!1}}const f=n.next();if(f.done)return f;const r=j([t(f.value)],M,[]);return r.length>1&&(e=r,o=1),{value:r[0],done:!1}}}},m=(Promise.race.bind(Promise),function(n,t){const e=[],o=new Set;let f=!1;return async function(){for await(const f of n){let n=t(f);i(n)&&(n=await n);const r=j([n],M,e);if(i(r)){const n=r.then((()=>o.delete(n)));o.add(n)}}f=!0}(),{[p](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){for(;0==e.length;){if(f&&0==o.size)return{value:void 0,done:!0};await new Promise((n=>setTimeout(n,50)))}return{value:e.shift(),done:!1}}}}),S=ArrayBuffer.isView,O=n=>function(){return n},A=(n,t)=>t,P=n=>n,B=Promise.all.bind(Promise),F=async function(n,t){const e=[];for await(const o of n){const n=t(o);i(n)&&e.push(n)}return 0==e.length?n:B(e).then(O(n))},T=function(t){const e=t.length,o=[],f=[];let r=-1;for(;++r<e;){const e=t[r];if(n(e)){const n=e.length;let t=-1;for(;++t<n;)f.push(e[t])}else if(null==e)f.push(e);else if("function"==typeof e.then)o.push(e.then(d(M,f,u)));else if("function"==typeof e[h])for(const n of e)f.push(n);else if("function"==typeof e[p])o.push(F(e[p](),d(M,f,u)));else if("function"==typeof e.chain){const n=e.chain(P);i(n)?o.push(n.then(d(M,f,u))):f.push(n)}else if("function"==typeof e.flatMap){const n=e.flatMap(P);i(n)?o.push(n.then(d(M,f,u))):f.push(n)}else if("function"==typeof e.reduce){const n=e.reduce(b(A,d(M,f,u)),null);i(n)&&o.push(n)}else if(e.constructor==Object)for(const n in e)f.push(e[n]);else f.push(e)}return 0==o.length?f:B(o).then(O(f))},z=function(n,t){const e=n.length,o=Array(e);let f=-1,r=!1;for(;++f<e;){const e=t(n[f]);i(e)&&(r=!0),o[f]=e}return r?B(o):o},G=n=>new Promise((n=>function(t){const e={};let o=0;for(const f in n){const r=n[f];i(r)?(o+=1,r.then((n=>function(f){e[n]=f,o-=1,0==o&&t(e)})(f))):e[f]=r}0==o&&t(e)})(n)),I=Object.assign,V=function(n){const t=[],e={},o=d(I,e,u),f=b(A,o);for(const r in n){const u=n[r];if(null!=u)if("function"==typeof u[h])for(const n of u)I(e,n);else if("function"==typeof u[p])t.push(F(u[p](),o));else if("function"==typeof u.chain){const n=u.chain(P);i(n)?t.push(n.then(o)):I(e,n)}else if("function"==typeof u.flatMap){const n=u.flatMap(P);i(n)?t.push(n.then(o)):o(n)}else if("function"==typeof u.reduce){const n=u.reduce(f,null);i(n)&&t.push(n)}else I(e,u)}return 0==t.length?e:B(t).then((()=>e))},k=function(n,t){const e=function(n,t){const e={};let o=!1;for(const f in n){const r=t(n[f]);i(r)&&(o=!0),e[f]=r}return o?G(e):e}(n,t);return i(e)?e.then(V):V(e)},q=(n,t,e)=>n[t](e),C=function(t){t.size;const e=[],o=new Set,f=(n,t)=>o.add(t),r=c(q,o,"add",u);for(const u of t)if(n(u)){const n=u.length;let t=-1;for(;++t<n;)o.add(u[t])}else if(null==u)o.add(u);else if("function"==typeof u[h])for(const n of u)o.add(n);else if("function"==typeof u[p])e.push(F(u[p](),r));else if("function"==typeof u.chain){const n=u.chain(P);i(n)?e.push(n.then(r)):o.add(n)}else if("function"==typeof u.flatMap){const n=u.flatMap(P);i(n)?e.push(n.then(r)):o.add(n)}else if("function"==typeof u.reduce){const n=u.reduce(f,null);i(n)&&e.push(n)}else if(u.constructor==Object)for(const n in u)o.add(u[n]);else o.add(u);return 0==e.length?o:B(e).then((()=>o))},D=function(n,t){const e=function(n,t){const e=new Set,o=[];for(const f of n){const n=t(f);i(n)?o.push(n.then(c(q,e,"add",u))):e.add(n)}return 0==o.length?e:B(o).then(O(e))}(n,t);return i(e)?e.then(C):C(e)},E=(H=T,J=d(((n,t)=>n.join(t)),u,""),function(...n){const t=H(...n);return i(t)?t.then(J):J(t)});var H,J;const K=function(n,t,e,o){return n.write(t,e,o),n},L=async function(t,e){const o=d(K,t,u),f=b(A,o),r=[];if(n(e)){const n=e.length;let o=-1;for(;++o<n;)t.write(e[o])}else if(null==e)t.write(e);else if("function"==typeof e[h])for(const n of e)t.write(n);else if("function"==typeof e[p])r.push(F(e[p](),o));else if("function"==typeof e.chain){const n=e.chain(P);i(n)?r.push(n.then(o)):t.write(n)}else if("function"==typeof e.flatMap){const n=e.flatMap(P);i(n)?r.push(n.then(o)):t.write(n)}else if("function"==typeof e.reduce){const n=e.reduce(f,null);i(n)&&r.push(n)}else if(e.constructor==Object)for(const n in e)t.write(e[n]);else t.write(e);return 0==r.length?t:B(r).then(O(t))},N="function"==typeof Buffer,Q=N?Buffer.alloc:function(){},R=function(n,t){const e=n.length,o=N&&n.constructor==Buffer?Q(e+t.length):new n.constructor(e+t.length);return o.set(n),o.set(t,e),o},U=function(t,e){return n(e)||S(e)?R(t,e):R(t,[e])},W=function(n,t){const e=n.length;let o=-1,f=t;for(;++o<e;)f=U(f,n[o]);return f},X=function(n,t){const e=T(n);return i(e)?e.then(d(W,u,t)):W(e,t)};return t=>function(e){if(n(e))return function(n,t){const e=z(n,t);return i(e)?e.then(T):T(e)}(e,t);if("function"==typeof e)return f(e)?((n,t)=>function*(...e){yield*x(n(...e),t)})(e,t):r(e)?((n,t)=>async function*(...e){yield*m(n(...e),t)})(e,t):((n,t)=>function(e,o){const f=t(o);return i(f)?f.then(y(j,u,n,e)):j([f],n,e)})(e,t);if(S(e))return function(n,t){const e=z(n,t),o=N&&n.constructor==Buffer?Q(0):new n.constructor(0);return i(e)?e.then(d(X,u,o)):X(e,o)}(e,t);if(null==e)return t(e);if("function"==typeof e.then)return e.then(t);if("function"==typeof e.next)return h in e?x(e,t):m(e,t);if("function"==typeof e.chain)return e.chain(t);if("function"==typeof e.flatMap)return e.flatMap(t);if("function"==typeof e[p]&&"function"==typeof e.write)return async function(n,t){const e=new Set;for await(const o of n){const f=t(o);if(i(f)){const t=f.then(d(L,n,u)).then((()=>e.delete(t)));e.add(t)}else{const t=L(n,f);if(i(t)){const n=t.then((()=>e.delete(n)));e.add(n)}}}return await B(e),n}(e,t);const o=e.constructor;return o==Object?k(e,t):o==Set?D(e,t):"string"==typeof e||o==String?function(n,t){const e=z(n,t);return i(e)?e.then(E):E(e)}(e,t):t(e)}}());
