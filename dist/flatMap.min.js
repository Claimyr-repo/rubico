/**
 * rubico v1.8.6
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.flatMap=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Array.isArray,t=(Object.values,Object.prototype.toString),e=n=>t.call(n),o=n=>"[object GeneratorFunction]"==e(n),r=n=>"[object AsyncGeneratorFunction]"==e(n),u=Symbol.for("placeholder"),f=function(n,t,e,o){return t==u?((n,t,e)=>function(o){return n(o,t,e)})(n,e,o):e==u?((n,t,e)=>function(o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(o){return n(t,e,o)})(n,t,e)},c=n=>null!=n&&"function"==typeof n.then,i=async function(n,t,e){let o=n.next();if(o.done)return e;for(;!o.done;)e=t(e,o.value),c(e)&&(e=await e),o=n.next();return e},s=function(n,t,e){let o=n.next();if(o.done)return e;for(void 0===e&&(e=o.value,o=n.next());!o.done;){if(e=t(e,o.value),c(e))return e.then(f(i,n,t,u));o=n.next()}return e},l=async function(n,t,e){let o=await n.next();if(o.done)return e;for(void 0===e&&(e=o.value,o=await n.next());!o.done;)e=await t(e,o.value),o=await n.next();return e},a=Symbol.iterator,h=Symbol.asyncIterator,p=function(n,t,e){return t==u?((n,t)=>function(e){return n(e,t)})(n,e):((n,t)=>function(e){return n(t,e)})(n,t)},d=function(n,t,e,o){return t==u?((n,t,e)=>function(...o){return n(o,t,e)})(n,e,o):e==u?((n,t,e)=>function(...o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(...o){return n(t,e,o)})(n,t,e)},y=function(n,t,e,o,r){return t==u?((n,t,e,o)=>function(r){return n(r,t,e,o)})(n,e,o,r):e==u?((n,t,e,o)=>function(r){return n(t,r,e,o)})(n,t,o,r):o==u?((n,t,e,o)=>function(r){return n(t,e,r,o)})(n,t,e,r):((n,t,e,o)=>function(r){return n(t,e,o,r)})(n,t,e,o)},g=async function(n,t,e,o){const r=n.length;for(;++o<r;)e=t(e,n[o],o,n),c(e)&&(e=await e);return e},w=Object.keys,v=async function(n,t,e,o,r){const u=o.length;for(;++r<u;){const u=o[r];e=t(e,n[u],u,n),c(e)&&(e=await e)}return e},b=async function(n,t,e,o){for(const[r,u]of o)e=t(e,u,r,n),c(e)&&(e=await e);return e},j=(n,t)=>function(...e){return t(n(...e))},x=(n,t)=>function(e,o){const r=n(e,o);return c(r)?r.then(p(t,u,o)):t(r,o)},M=function(t,e,i){const S=t[0];return n(S)?function(n,t,e){const o=n.length;let r=-1;for(void 0===e&&(e=n[++r]);++r<o;)if(e=t(e,n[r],r,n),c(e))return e.then(y(g,n,t,u,r));return e}(S,e,i):"function"==typeof S?o(S)?((n,t,e)=>j(n,f(s,u,t,e)))(S,e,i):r(S)?((n,t,e)=>j(n,f(l,u,t,e)))(S,e,i):d(M,u,1==t.length?x(e,S):t.reduce(x,e),i):null==S?void 0===i?p(e,S,u):e(i,S):S.constructor==Map?function(n,t,e){const o=n.entries();if(void 0===e){const n=o.next();if(n.done)return e;e=n.value[1]}for(const[r,f]of o)if(e=t(e,f,r,n),c(e))return e.then(y(b,n,t,u,o));return e}(S,e,i):"function"==typeof S[a]?s(S[a](),e,i):"function"==typeof S[h]?l(S[h](),e,i):"function"==typeof S.reduce?S.reduce(e,i):"function"==typeof S.chain?S.chain(p(e,i,u)):"function"==typeof S.flatMap?S.flatMap(p(e,i,u)):S.constructor==Object?function(n,t,e){const o=w(n),r=o.length;let f=-1;for(void 0===e&&(e=n[o[++f]]);++f<r;){const r=o[f];if(e=t(e,n[r],r,n),c(e))return e.then((i=v,l=t,a=u,h=o,p=f,(s=n)==u?((n,t,e,o,r)=>function(u){return n(u,t,e,o,r)})(i,l,a,h,p):l==u?((n,t,e,o,r)=>function(u){return n(t,u,e,o,r)})(i,s,a,h,p):a==u?((n,t,e,o,r)=>function(u){return n(t,e,u,o,r)})(i,s,l,h,p):h==u?((n,t,e,o,r)=>function(u){return n(t,e,o,u,r)})(i,s,l,a,p):((n,t,e,o,r)=>function(u){return n(t,e,o,r,u)})(i,s,l,a,h)))}var i,s,l,a,h,p;return e}(S,e,i):void 0===i?p(e,S,u):e(i,S)},S=function(n,t){return n.push(t),n},m=function(n,t){let e=[],o=0;return{[a](){return this},next(){if(o<e.length){const n=e[o];return o+=1,{value:n,done:!1}}const r=n.next();if(r.done)return r;const u=M([t(r.value)],S,[]);return u.length>1&&(e=u,o=1),{value:u[0],done:!1}}}},A=function(n){let t=!1;return function(...e){if(!t)return t=!0,n(...e)}},O=function(n){return new Promise(((t,e)=>{const o=A(t),r=A(e);n.forEach((n=>{n.then(o,r)}))}))},B=function(n,t){const e=[],o=new Set;return{isAsyncIteratorDone:!1,[h](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){for(;!this.isAsyncIteratorDone||e.length>0||o.size>0;){const{value:r,done:f}=await n.next();if(f)this.isAsyncIteratorDone=f;else{const n=t(r);if(c(n)){const t=n.then(d(M,u,S,e)).then((()=>o.delete(t)));o.add(t)}else{const t=M([n],S,e);if(c(t)){const n=t.then((()=>o.delete(n)));o.add(n)}}}if(e.length>0)return{value:e.shift(),done:!1};o.size>0&&await O(o)}return{value:void 0,done:!0}}}},I=ArrayBuffer.isView,P=n=>function(){return n},z=(n,t)=>t,D=n=>n,F=Promise.all.bind(Promise),G=async function(n,t){const e=[];for await(const o of n){const n=t(o);c(n)&&e.push(n)}return 0==e.length?n:F(e).then(P(n))},T=function(t){const e=t.length,o=[],r=[];let f=-1;for(;++f<e;){const e=t[f];if(n(e)){const n=e.length;let t=-1;for(;++t<n;)r.push(e[t])}else if(null==e)r.push(e);else if("function"==typeof e.then)o.push(e.then(p(S,r,u)));else if("function"==typeof e[a])for(const n of e)r.push(n);else if("function"==typeof e[h])o.push(G(e[h](),p(S,r,u)));else if("function"==typeof e.chain){const n=e.chain(D);c(n)?o.push(n.then(p(S,r,u))):r.push(n)}else if("function"==typeof e.flatMap){const n=e.flatMap(D);c(n)?o.push(n.then(p(S,r,u))):r.push(n)}else if("function"==typeof e.reduce){const n=e.reduce(j(z,p(S,r,u)),null);c(n)&&o.push(n)}else if(e.constructor==Object)for(const n in e)r.push(e[n]);else r.push(e)}return 0==o.length?r:F(o).then(P(r))},k=function(n,t){const e=n.length,o=Array(e);let r=-1,u=!1;for(;++r<e;){const e=t(n[r],r,n);c(e)&&(u=!0),o[r]=e}return u?F(o):o},E=n=>new Promise((n=>function(t){const e={};let o=0;for(const r in n){const u=n[r];c(u)?(o+=1,u.then((n=>function(r){e[n]=r,o-=1,0==o&&t(e)})(r))):e[r]=u}0==o&&t(e)})(n)),V=Object.assign,q=function(n){const t=[],e={},o=p(V,e,u),r=j(z,o);for(const u in n){const f=n[u];if(null!=f)if("function"==typeof f[a])for(const n of f)V(e,n);else if("function"==typeof f[h])t.push(G(f[h](),o));else if("function"==typeof f.chain){const n=f.chain(D);c(n)?t.push(n.then(o)):V(e,n)}else if("function"==typeof f.flatMap){const n=f.flatMap(D);c(n)?t.push(n.then(o)):o(n)}else if("function"==typeof f.reduce){const n=f.reduce(r,null);c(n)&&t.push(n)}else V(e,f)}return 0==t.length?e:F(t).then((()=>e))},C=function(n,t){const e=function(n,t){const e={};let o=!1;for(const r in n){const u=t(n[r],r,n);c(u)&&(o=!0),e[r]=u}return o?E(e):e}(n,t);return c(e)?e.then(q):q(e)},H=(n,t,e)=>n[t](e),J=function(t){t.size;const e=[],o=new Set,r=(n,t)=>o.add(t),i=f(H,o,"add",u);for(const u of t)if(n(u)){const n=u.length;let t=-1;for(;++t<n;)o.add(u[t])}else if(null==u)o.add(u);else if("function"==typeof u[a])for(const n of u)o.add(n);else if("function"==typeof u[h])e.push(G(u[h](),i));else if("function"==typeof u.chain){const n=u.chain(D);c(n)?e.push(n.then(i)):o.add(n)}else if("function"==typeof u.flatMap){const n=u.flatMap(D);c(n)?e.push(n.then(i)):o.add(n)}else if("function"==typeof u.reduce){const n=u.reduce(r,null);c(n)&&e.push(n)}else if(u.constructor==Object)for(const n in u)o.add(u[n]);else o.add(u);return 0==e.length?o:F(e).then((()=>o))},K=function(n,t){const e=function(n,t){const e=new Set,o=[];for(const r of n){const i=t(r,r,n);c(i)?o.push(i.then(f(H,e,"add",u))):e.add(i)}return 0==o.length?e:F(o).then(P(e))}(n,t);return c(e)?e.then(J):J(e)},L=(N=T,Q=p(((n,t)=>n.join(t)),u,""),function(...n){const t=N(...n);return c(t)?t.then(Q):Q(t)});var N,Q;const R=function(n,t,e,o){return n.write(t,e,o),n},U=async function(t,e){const o=p(R,t,u),r=j(z,o),f=[];if(n(e)){const n=e.length;let o=-1;for(;++o<n;)t.write(e[o])}else if(null==e)t.write(e);else if("function"==typeof e[a])for(const n of e)t.write(n);else if("function"==typeof e[h])f.push(G(e[h](),o));else if("function"==typeof e.chain){const n=e.chain(D);c(n)?f.push(n.then(o)):t.write(n)}else if("function"==typeof e.flatMap){const n=e.flatMap(D);c(n)?f.push(n.then(o)):t.write(n)}else if("function"==typeof e.reduce){const n=e.reduce(r,null);c(n)&&f.push(n)}else if(e.constructor==Object)for(const n in e)t.write(e[n]);else t.write(e);return 0==f.length?t:F(f).then(P(t))},W="function"==typeof Buffer,X=W?Buffer.alloc:function(){},Y=function(n,t){const e=n.length,o=W&&n.constructor==Buffer?X(e+t.length):new n.constructor(e+t.length);return o.set(n),o.set(t,e),o},Z=function(t,e){return n(e)||I(e)?Y(t,e):Y(t,[e])},$=function(n,t){const e=n.length;let o=-1,r=t;for(;++o<e;)r=Z(r,n[o]);return r},_=function(n,t){const e=T(n);return c(e)?e.then(p($,u,t)):$(e,t)};return t=>function(e){if(n(e))return function(n,t){const e=k(n,t);return c(e)?e.then(T):T(e)}(e,t);if("function"==typeof e)return o(e)?((n,t)=>function*(...e){yield*m(n(...e),t)})(e,t):r(e)?((n,t)=>async function*(...e){yield*B(n(...e),t)})(e,t):((n,t)=>function(e,o){const r=t(o);return c(r)?r.then(d(M,u,n,e)):M([r],n,e)})(e,t);if(I(e))return function(n,t){const e=k(n,t),o=W&&n.constructor==Buffer?X(0):new n.constructor(0);return c(e)?e.then(p(_,u,o)):_(e,o)}(e,t);if(null==e)return t(e);if("function"==typeof e.then)return e.then(t);if("function"==typeof e.next)return a in e?m(e,t):B(e,t);if("function"==typeof e.chain)return e.chain(t);if("function"==typeof e.flatMap)return e.flatMap(t);if("function"==typeof e[h]&&"function"==typeof e.write)return async function(n,t){const e=new Set;for await(const o of n){const r=t(o);if(c(r)){const t=r.then(p(U,n,u)).then((()=>e.delete(t)));e.add(t)}else{const t=U(n,r);if(c(t)){const n=t.then((()=>e.delete(n)));e.add(n)}}}return await F(e),n}(e,t);const f=e.constructor;return f==Object?C(e,t):f==Set?K(e,t):"string"==typeof e||f==String?function(n,t){const e=k(n,t);return c(e)?e.then(L):L(e)}(e,t):t(e)}}());
