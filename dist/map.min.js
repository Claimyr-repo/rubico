/**
 * rubico v1.6.3
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.map=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Symbol.iterator,t=(t,o)=>({toString:()=>"[object MappingIterator]",[n](){return this},next(){const n=t.next();return n.done?n:{value:o(n.value),done:!1}}}),o=n=>({value:n,done:!1}),r=n=>null!=n&&"function"==typeof n.then,e=Symbol.asyncIterator,c=(n,t)=>({[e](){return this},async next(){const e=await n.next();if(e.done)return e;const c=t(e.value);return r(c)?c.then(o):{value:c,done:!1}}}),u=Array.isArray,i=Object.prototype.toString,f=n=>i.call(n),s=Promise.all.bind(Promise),a=function(n,t){const o=n.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=t(n[c]);r(o)&&(u=!0),e[c]=o}return u?s(e):e},l=Symbol.for("placeholder"),y=(n,t)=>function(o,e){const c=t(e);return r(c)?c.then((u=n,f=l,(i=o)==l?((n,t)=>function(o){return n(o,t)})(u,f):((n,t)=>function(o){return n(t,o)})(u,i))):n(o,c);var u,i,f},h=function(n,t,o,r){return t==l?((n,t,o)=>function(r){return n(r,t,o)})(n,o,r):o==l?((n,t,o)=>function(r){return n(t,r,o)})(n,t,r):((n,t,o)=>function(r){return n(t,o,r)})(n,t,o)},p=(n,t,o)=>n[t](o),d=n=>function(){return n},w=function(n,t,o,r,e){return t==l?((n,t,o,r)=>function(e){return n(e,t,o,r)})(n,o,r,e):o==l?((n,t,o,r)=>function(e){return n(t,e,o,r)})(n,t,r,e):r==l?((n,t,o,r)=>function(e){return n(t,o,e,r)})(n,t,o,e):((n,t,o,r)=>function(e){return n(t,o,r,e)})(n,t,o,r)},b=(n,t,o,r)=>n[t](o,r),g=n=>new Promise((n=>function(t){const o={};let e=0;for(const c in n){const u=n[c];r(u)?(e+=1,u.then((n=>function(r){o[n]=r,e-=1,0==e&&t(o)})(c))):o[c]=u}0==e&&t(o)})(n)),m=(n,t)=>function(...o){const e=n(...o);return r(e)?e.then(t):t(e)},j=function(n,t,o){return n[t]=o,n},A=async function(n,t,o,e){const c=n.length;for(;++e<c;){const c=t(n[e]);o[e]=r(c)?await c:c}return o},S=n=>function(...t){return n(...t),t[0]},x=Promise.race.bind(Promise),v=async function(n,t,o,e,c,u){const i=n.length;for(;++c<i;){u.size>=o&&await x(u);const i=t(n[c]);if(r(i)){const n=i.then(S((()=>u.delete(n))));u.add(n),e[c]=n}else e[c]=i}return s(e)},P=Object.prototype.hasOwnProperty,T=(n,t)=>P.call(n,t),O=o=>function(e){return u(e)?a(e,o):"function"==typeof e?(n=>"[object GeneratorFunction]"==f(n))(e)?((n,t)=>function*(...o){for(const r of n(...o))yield t(r)})(e,o):(n=>"[object AsyncGeneratorFunction]"==f(n))(e)?function(n,t){return async function*(...o){for await(const r of n(...o))yield t(r)}}(e,o):y(e,o):null==e?e:"function"==typeof e.map?e.map(o):"function"==typeof e.next?n in e?t(e,o):c(e,o):"string"==typeof e||e.constructor==String?function(n,t){const o=a(n,t);return r(o)?o.then(h(p,l,"join","")):o.join("")}(e,o):e.constructor==Set?function(n,t){const o=new Set,e=[];for(const c of n){const n=t(c);r(n)?e.push(n.then(h(p,o,"add",l))):o.add(n)}return 0==e.length?o:s(e).then(d(o))}(e,o):e.constructor==Map?function(n,t){const o=new Map,e=[];for(const[c,u]of n){const n=t(u);r(n)?e.push(n.then(w(b,o,"set",c,l))):o.set(c,n)}return 0==e.length?o:s(e).then(d(o))}(e,o):e.constructor==Object?function(n,t){const o={};let e=!1;for(const c in n){const u=t(n[c]);r(u)&&(e=!0),o[c]=u}return e?g(o):o}(e,o):o(e)};return O.series=n=>function(t){if(u(t))return function(n,t){const o=n.length,e=Array(o);let c=-1;for(;++c<o;){const o=t(n[c]);if(r(o))return o.then(m(h(j,e,c,l),w(A,n,t,l,c)));e[c]=o}return e}(t,n);throw new TypeError(t+" is not an Array")},O.pool=(n,t)=>function(o){if(u(o))return function(n,t,o){const e=n.length,c=Array(e);let u=-1;for(;++u<e;){const e=t(n[u]);if(r(e)){const r=new Set,i=e.then(S((()=>r.delete(i))));return r.add(i),c[u]=i,v(n,t,o,c,u,r)}c[u]=e}return c}(o,t,n);throw new TypeError(o+" is not an Array")},O.withIndex=n=>function(t){if(u(t))return function(n,t){const o=n.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=t(n[c],c,n);r(o)&&(u=!0),e[c]=o}return u?s(e):e}(t,n);throw new TypeError(t+" is not an Array")},O.own=n=>function(t){if((n=>null!=n&&("object"==typeof n||"function"==typeof n))(t)&&!u(t))return function(n,t){const o={};let e=!1;for(const c in n)if(T(n,c)){const u=t(n[c]);r(u)&&(e=!0),o[c]=u}return e?g(o):o}(t,n);throw new TypeError(t+" is not an Object")},O}());
