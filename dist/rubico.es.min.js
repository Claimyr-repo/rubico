/**
 * rubico v1.6.21
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2020 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */
const noop=function(){},isPromise=n=>null!=n&&"function"==typeof n.then,funcConcat=(n,t)=>function(...r){const e=n(...r);return isPromise(e)?e.then(t):t(e)},funcConcatSync=(n,t)=>function(...r){return t(n(...r))},objectProto=Object.prototype,nativeObjectToString=objectProto.toString,objectToString=n=>nativeObjectToString.call(n),generatorFunctionTag="[object GeneratorFunction]",isGeneratorFunction=n=>objectToString(n)==generatorFunctionTag,asyncGeneratorFunctionTag="[object AsyncGeneratorFunction]",isAsyncGeneratorFunction=n=>objectToString(n)==asyncGeneratorFunctionTag,pipe=function(n){let t=noop,r=noop;return function(...e){const o=e[0];return"function"!=typeof o||isGeneratorFunction(o)||isAsyncGeneratorFunction(o)?(t==noop&&(t=n.reduce(funcConcat)),t(...e)):(r==noop&&(r=n.reduceRight(funcConcat)),r(...e))}},pipeSync=n=>n.reduce(funcConcatSync);pipe.sync=pipeSync;const isArray=Array.isArray,promiseAll=Promise.all.bind(Promise),funcAll=n=>function(...t){const r=n.length,e=Array(r);let o=-1,i=!1;for(;++o<r;){const r=n[o](...t);isPromise(r)&&(i=!0),e[o]=r}return i?promiseAll(e):e},always=n=>function(){return n},__=Symbol.for("placeholder"),curry3ResolveArg0=(n,t,r)=>function(e){return n(e,t,r)},curry3ResolveArg1=(n,t,r)=>function(e){return n(t,e,r)},curry3ResolveArg2=(n,t,r)=>function(e){return n(t,r,e)},curry3=function(n,t,r,e){return t==__?curry3ResolveArg0(n,r,e):r==__?curry3ResolveArg1(n,t,e):curry3ResolveArg2(n,t,r)},objectSet=function(n,t,r){return n[t]=r,n},funcObjectAll=n=>function(...t){const r={},e=[];for(const o in n){const i=n[o](...t);isPromise(i)?e.push(i.then(curry3(objectSet,r,o,__))):r[o]=i}return 0==e.length?r:promiseAll(e).then(always(r))},curry4ResolveArg0=(n,t,r,e)=>function(o){return n(o,t,r,e)},curry4ResolveArg1=(n,t,r,e)=>function(o){return n(t,o,r,e)},curry4ResolveArg2=(n,t,r,e)=>function(o){return n(t,r,o,e)},curry4ResolveArg3=(n,t,r,e)=>function(o){return n(t,r,e,o)},curry4=function(n,t,r,e,o){return t==__?curry4ResolveArg0(n,r,e,o):r==__?curry4ResolveArg1(n,t,e,o):e==__?curry4ResolveArg2(n,t,r,o):curry4ResolveArg3(n,t,r,e)},asyncFuncAllSeries=async function(n,t,r,e){const o=n.length;for(;++e<o;){const o=n[e](...t);r[e]=isPromise(o)?await o:o}return r},funcAllSeries=n=>function(...t){const r=n.length,e=[];let o=-1;for(;++o<r;){const r=n[o](...t);if(isPromise(r))return r.then(funcConcat(curry3(objectSet,e,o,__),curry4(asyncFuncAllSeries,n,t,__,o)));e[o]=r}return e},fork=n=>isArray(n)?funcAll(n):funcObjectAll(n);fork.series=n=>isArray(n)?funcAllSeries(n):funcObjectAll(n);const objectAssign=Object.assign,assign=function(n){const t=funcObjectAll(n);return function(n){const r=t(n);return isPromise(r)?r.then(curry3(objectAssign,{},n,__)):{...n,...r}}},tapSync=n=>function(...t){return n(...t),t[0]},thunkifyArgs=(n,t)=>function(){return n(...t)},thunkConditional=(n,t,r)=>n?t():r(),tap=n=>function(...t){const r=t[0],e=n(...t);return isPromise(e)?e.then(always(r)):r};tap.sync=tapSync,tap.if=(n,t)=>function(...r){const e=n(...r);if(isPromise(e))return e.then(curry3(thunkConditional,__,thunkifyArgs(tap(t),r),always(r[0])));if(e){const n=t(...r);if(isPromise(n))return n.then(always(r[0]))}return r[0]};const catcherApply=function(n,t,r){return n(t,...r)},tryCatch=(n,t)=>function(...r){try{const e=n(...r);return isPromise(e)?e.catch(curry3(catcherApply,t,__,r)):e}catch(n){return t(n,...r)}},thunkify3=(n,t,r,e)=>function(){return n(t,r,e)},funcConditional=function(n,t,r){const e=n.length-1;for(;(r+=2)<e;){const e=n[r],o=n[r+1],i=e(...t);if(isPromise(i))return i.then(curry3(thunkConditional,__,thunkifyArgs(o,t),thunkify3(funcConditional,n,t,r)));if(i)return o(...t)}return n[r](...t)},switchCase=n=>function(...t){return funcConditional(n,t,-2)},symbolIterator=Symbol.iterator,MappingIterator=(n,t)=>({toString:()=>"[object MappingIterator]",[symbolIterator](){return this},next(){const r=n.next();return r.done?r:{value:t(r.value),done:!1}}}),NextIteration=n=>({value:n,done:!1}),symbolAsyncIterator=Symbol.asyncIterator,MappingAsyncIterator=(n,t)=>({[symbolAsyncIterator](){return this},async next(){const r=await n.next();if(r.done)return r;const e=t(r.value);return isPromise(e)?e.then(NextIteration):{value:e,done:!1}}}),isObject=n=>{if(null==n)return!1;const t=typeof n;return"object"==t||"function"==t},arrayMap=function(n,t){const r=n.length,e=Array(r);let o=-1,i=!1;for(;++o<r;){const r=t(n[o]);isPromise(r)&&(i=!0),e[o]=r}return i?promiseAll(e):e},generatorFunctionMap=(n,t)=>function*(...r){for(const e of n(...r))yield t(e)},asyncGeneratorFunctionMap=function(n,t){return async function*(...r){for await(const e of n(...r))yield t(e)}},curry2ResolveArg0=(n,t)=>function(r){return n(r,t)},curry2ResolveArg1=(n,t)=>function(r){return n(t,r)},curry2=function(n,t,r){return t==__?curry2ResolveArg0(n,r):curry2ResolveArg1(n,t)},reducerMap=(n,t)=>function(r,e){const o=t(e);return isPromise(o)?o.then(curry2(n,r,__)):n(r,o)},callPropUnary=(n,t,r)=>n[t](r),stringMap=function(n,t){const r=arrayMap(n,t);return isPromise(r)?r.then(curry3(callPropUnary,__,"join","")):r.join("")},setMap=function(n,t){const r=new Set,e=[];for(const o of n){const n=t(o);isPromise(n)?e.push(n.then(curry3(callPropUnary,r,"add",__))):r.add(n)}return 0==e.length?r:promiseAll(e).then(always(r))},callPropBinary=(n,t,r,e)=>n[t](r,e),mapMap=function(n,t){const r=new Map,e=[];for(const[o,i]of n){const n=t(i);isPromise(n)?e.push(n.then(curry4(callPropBinary,r,"set",o,__))):r.set(o,n)}return 0==e.length?r:promiseAll(e).then(always(r))},promiseObjectAllExecutor=n=>function(t){const r={};let e=0;for(const o in n){const i=n[o];isPromise(i)?(e+=1,i.then((n=>function(o){r[n]=o,e-=1,0==e&&t(r)})(o))):r[o]=i}0==e&&t(r)},promiseObjectAll=n=>new Promise(promiseObjectAllExecutor(n)),objectMap=function(n,t){const r={};let e=!1;for(const o in n){const i=t(n[o]);isPromise(i)&&(e=!0),r[o]=i}return e?promiseObjectAll(r):r},arrayMapSeriesAsync=async function(n,t,r,e){const o=n.length;for(;++e<o;){const o=t(n[e]);r[e]=isPromise(o)?await o:o}return r},arrayMapSeries=function(n,t){const r=n.length,e=Array(r);let o=-1;for(;++o<r;){const r=t(n[o]);if(isPromise(r))return r.then(funcConcat(curry3(objectSet,e,o,__),curry4(arrayMapSeriesAsync,n,t,__,o)));e[o]=r}return e},promiseRace=Promise.race.bind(Promise),arrayMapPoolAsync=async function(n,t,r,e,o,i){const c=n.length;for(;++o<c;){i.size>=r&&await promiseRace(i);const c=t(n[o]);if(isPromise(c)){const n=c.then(tapSync((()=>i.delete(n))));i.add(n),e[o]=n}else e[o]=c}return promiseAll(e)},arrayMapPool=function(n,t,r){const e=n.length,o=Array(e);let i=-1;for(;++i<e;){const e=t(n[i]);if(isPromise(e)){const c=new Set,s=e.then(tapSync((()=>c.delete(s))));return c.add(s),o[i]=s,arrayMapPoolAsync(n,t,r,o,i,c)}o[i]=e}return o},arrayMapWithIndex=function(n,t){const r=n.length,e=Array(r);let o=-1,i=!1;for(;++o<r;){const r=t(n[o],o,n);isPromise(r)&&(i=!0),e[o]=r}return i?promiseAll(e):e},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(n,t)=>hasOwnProperty.call(n,t),objectMapOwn=function(n,t){const r={};let e=!1;for(const o in n)if(hasOwn(n,o)){const i=t(n[o]);isPromise(i)&&(e=!0),r[o]=i}return e?promiseObjectAll(r):r},_curryArity=(n,t,r)=>function(...e){const o=r.length,i=e.length,c=[];let s=-1,a=-1,u=0;for(;++s<o;){const o=r[s];if(o==__&&(a+=1)<i){const n=e[a];n==__&&(u+=1),c.push(n)}else c.push(o);if(c.length==n)return 0==u?t(...c):curryArity(n,t,c)}for(;++a<i;){const r=e[a];if(r==__&&(u+=1),c.push(r),c.length==n)return 0==u?t(...c):curryArity(n,t,c)}return curryArity(n,t,c)},curryArity=function(n,t,r){const e=r.length;if(e<n)return _curryArity(n,t,r);let o=-1;for(;++o<e;){if(r[o]==__)return _curryArity(n,t,r)}return t(...r)},spread2=n=>function([t,r]){return n(t,r)},objectMapEntries=function(n,t){const r={},e=[];for(const o in n){const i=t([o,n[o]]);isPromise(i)?e.push(i.then(spread2(curryArity(3,objectSet,[r])))):r[i[0]]=i[1]}return 0==e.length?r:promiseAll(e).then(always(r))},mapSet=function(n,t,r){return n.set(t,r)},mapMapEntriesForEachCallback=(n,t,r)=>function(e,o){const i=n([o,e]);isPromise(i)?r.push(i.then(spread2(curryArity(3,mapSet,[t])))):t.set(i[0],i[1])},mapMapEntries=function(n,t){const r=new Map,e=[];return n.forEach(mapMapEntriesForEachCallback(t,r,e)),0==e.length?r:promiseAll(e).then(always(r))},map=n=>function(t){return isArray(t)?arrayMap(t,n):"function"==typeof t?isGeneratorFunction(t)?generatorFunctionMap(t,n):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionMap(t,n):reducerMap(t,n):null==t?t:"function"==typeof t.then?t.then(n):"function"==typeof t.map?t.map(n):"function"==typeof t.next?symbolIterator in t?MappingIterator(t,n):MappingAsyncIterator(t,n):"string"==typeof t||t.constructor==String?stringMap(t,n):t.constructor==Set?setMap(t,n):t.constructor==Map?mapMap(t,n):t.constructor==Object?objectMap(t,n):n(t)};map.entries=function(n){return function(t){if(null==t)throw new TypeError("value is not an Object or Map");if(t.constructor==Object)return objectMapEntries(t,n);if(t.constructor==Map)return mapMapEntries(t,n);throw new TypeError("value is not an Object or Map")}},map.series=n=>function(t){if(isArray(t))return arrayMapSeries(t,n);throw new TypeError(`${t} is not an Array`)},map.pool=(n,t)=>function(r){if(isArray(r))return arrayMapPool(r,t,n);throw new TypeError(`${r} is not an Array`)},map.withIndex=n=>function(t){if(isArray(t))return arrayMapWithIndex(t,n);throw new TypeError(`${t} is not an Array`)},map.own=n=>function(t){if(isObject(t)&&!isArray(t))return objectMapOwn(t,n);throw new TypeError(`${t} is not an Object`)};const FilteringIterator=(n,t)=>({[symbolIterator](){return this},next(){let r=n.next();for(;!r.done;){const{value:e}=r;if(t(e))return{value:e,done:!1};r=n.next()}return r}}),FilteringAsyncIterator=(n,t)=>({[symbolAsyncIterator](){return this},async next(){let r=await n.next();for(;!r.done;){const{value:e}=r,o=t(e);if(isPromise(o)?await o:o)return{value:e,done:!1};r=await n.next()}return r}}),arrayExtendMap=function(n,t,r,e){const o=t.length;let i=n.length-1;for(;++e<o;)n[++i]=r(t[e]);return n},arrayFilterByConditions=function(n,t,r,e){const o=n.length;let i=-1;for(;++r<o;)e[++i]&&t.push(n[r]);return t},arrayFilter=function(n,t){const r=n.length,e=[];let o=-1,i=-1;for(;++o<r;){const r=n[o],c=t(r);if(isPromise(c))return promiseAll(arrayExtendMap([c],n,t,o)).then(curry4(arrayFilterByConditions,n,e,o-1,__));c&&(e[++i]=r)}return e},generatorFunctionFilter=(n,t)=>function*(...r){yield*FilteringIterator(n(...r),t)},asyncGeneratorFunctionFilter=(n,t)=>async function*(...r){yield*FilteringAsyncIterator(n(...r),t)},thunkify2=(n,t,r)=>function(){return n(t,r)},reducerFilter=(n,t)=>function(r,e){const o=t(e);return isPromise(o)?o.then(curry3(thunkConditional,__,(i=n,c=r,s=e,function(){return i(c,s)}),always(r))):o?n(r,e):r;var i,c,s},stringFilter=function(n,t){const r=arrayFilter(n,t);return isPromise(r)?r.then(curry3(callPropUnary,__,"join","")):r.join("")},thunkify1=(n,t)=>function(){return n(t)},setFilter=function(n,t){const r=new Set,e=r.add.bind(r),o=[];for(const i of n){const n=t(i);isPromise(n)?o.push(n.then(curry3(thunkConditional,__,thunkify1(e,i),noop))):n&&r.add(i)}return 0==o.length?r:promiseAll(o).then(always(r))},thunkify4=(n,t,r,e,o)=>function(){return n(t,r,e,o)},mapFilter=function(n,t){const r=new Map,e=[];for(const[o,i]of n){const n=t(i);isPromise(n)?e.push(n.then(curry3(thunkConditional,__,thunkify4(callPropBinary,r,"set",o,i),noop))):n&&r.set(o,i)}return 0==e.length?r:promiseAll(e).then(always(r))},objectSetIf=function(n,t,r,e){e&&(n[t]=r)},objectFilter=function(n,t){const r={},e=[];for(const o in n){const i=n[o],c=t(i);isPromise(c)?e.push(c.then(curry4(objectSetIf,r,o,n[o],__))):c&&(r[o]=i)}return 0==e.length?r:promiseAll(e).then(always(r))},arrayExtendMapWithIndex=function(n,t,r,e){const o=t.length;let i=n.length-1;for(;++e<o;)n[++i]=r(t[e],e,t);return n},arrayFilterWithIndex=function(n,t){const r=n.length,e=[];let o=-1,i=-1;for(;++o<r;){const r=n[o],c=t(r,o,n);if(isPromise(c))return promiseAll(arrayExtendMapWithIndex([c],n,t,o)).then(curry4(arrayFilterByConditions,n,e,o-1,__));c&&(e[++i]=r)}return e},filter=n=>function(t){return isArray(t)?arrayFilter(t,n):"function"==typeof t?isGeneratorFunction(t)?generatorFunctionFilter(t,n):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionFilter(t,n):reducerFilter(t,n):null==t?t:"function"==typeof t.next?symbolIterator in t?FilteringIterator(t,n):FilteringAsyncIterator(t,n):"string"==typeof t||t.constructor==String?stringFilter(t,n):t.constructor==Set?setFilter(t,n):t.constructor==Map?mapFilter(t,n):"function"==typeof t.filter?t.filter(n):t.constructor==Object?objectFilter(t,n):t};filter.withIndex=n=>function(t){if(isArray(t))return arrayFilterWithIndex(t,n);throw new TypeError(`${t} is not an Array`)};const curryArgs3ResolveArgs0=(n,t,r)=>function(...e){return n(e,t,r)},curryArgs3ResolveArgs1=(n,t,r)=>function(...e){return n(t,e,r)},curryArgs3ResolveArgs2=(n,t,r)=>function(...e){return n(t,r,e)},curryArgs3=function(n,t,r,e){return t==__?curryArgs3ResolveArgs0(n,r,e):r==__?curryArgs3ResolveArgs1(n,t,e):curryArgs3ResolveArgs2(n,t,r)},objectValues=Object.values,iteratorReduceAsync=async function(n,t,r){let e=n.next();if(e.done)return r;for(;!e.done;)r=t(r,e.value),isPromise(r)&&(r=await r),e=n.next();return r},iteratorReduce=function(n,t,r){let e=n.next();if(e.done)return r;for(void 0===r&&(r=e.value,e=n.next());!e.done;){if(r=t(r,e.value),isPromise(r))return r.then(curry3(iteratorReduceAsync,n,t,__));e=n.next()}return r},asyncIteratorReduce=async function(n,t,r){let e=await n.next();if(e.done)return r;for(void 0===r&&(r=e.value,e=await n.next());!e.done;)r=await t(r,e.value),e=await n.next();return r},arrayReduceAsync=async function(n,t,r,e){const o=n.length;for(;++e<o;)r=t(r,n[e]),isPromise(r)&&(r=await r);return r},arrayReduce=function(n,t,r){const e=n.length;let o=-1;for(void 0===r&&(r=n[++o]);++o<e;)if(r=t(r,n[o]),isPromise(r))return r.then(curry4(arrayReduceAsync,n,t,__,o));return r},generatorFunctionReduce=(n,t,r)=>funcConcatSync(n,curry3(iteratorReduce,__,t,r)),asyncGeneratorFunctionReduce=(n,t,r)=>funcConcatSync(n,curry3(asyncIteratorReduce,__,t,r)),reducerConcat=(n,t)=>function(r,e){const o=n(r,e);return isPromise(o)?o.then(curry2(t,__,e)):t(o,e)},genericReduce=function(n,t,r){const e=n[0];return isArray(e)?arrayReduce(e,t,r):"function"==typeof e?isGeneratorFunction(e)?generatorFunctionReduce(e,t,r):isAsyncGeneratorFunction(e)?asyncGeneratorFunctionReduce(e,t,r):curryArgs3(genericReduce,__,1==n.length?reducerConcat(t,e):n.reduce(reducerConcat,t),r):null==e?void 0===r?curry2(t,e,__):t(r,e):"function"==typeof e[symbolIterator]?iteratorReduce(e[symbolIterator](),t,r):"function"==typeof e[symbolAsyncIterator]?asyncIteratorReduce(e[symbolAsyncIterator](),t,r):"function"==typeof e.reduce?e.reduce(t,r):"function"==typeof e.chain?e.chain(curry2(t,r,__)):"function"==typeof e.flatMap?e.flatMap(curry2(t,r,__)):e.constructor==Object?arrayReduce(objectValues(e),t,r):void 0===r?curry2(t,e,__):t(r,e)},reduce=function(n,t){return"function"==typeof t?function(...r){const e=t(...r);return isPromise(e)?e.then(curry3(genericReduce,r,n,__)):genericReduce(r,n,e)}:curryArgs3(genericReduce,__,n,t)},isBinary=ArrayBuffer.isView,add=(n,t)=>n+t,isArrayLike=function(n){return null!=n&&n.length>0},_arrayExtend=function(n,t){const r=n.length,e=t.length;let o=-1;for(;++o<e;)n[r+o]=t[o];return n},arrayExtend=function(n,t){return null!=(r=t)&&r.length>0?_arrayExtend(n,t):(n.push(t),n);var r},globalThisHasBuffer="function"==typeof Buffer,bufferAlloc=globalThisHasBuffer?Buffer.alloc:noop,_binaryExtend=function(n,t){const r=n.length,e=globalThisHasBuffer&&n.constructor==Buffer?bufferAlloc(r+t.length):new n.constructor(r+t.length);return e.set(n),e.set(t,r),e},binaryExtend=function(n,t){return isArray(t)||isBinary(t)?_binaryExtend(n,t):_binaryExtend(n,[t])},isNodeReadStream=n=>null!=n&&"function"==typeof n.pipe,__streamWrite=n=>function(t,r,e){return n.write(t,r,e),n},_streamExtendExecutor=(n,t)=>function(r,e){t.on("data",__streamWrite(n)),t.on("end",thunkify1(r,n)),t.on("error",e)},_streamExtend=(n,t)=>new Promise(_streamExtendExecutor(n,t)),streamExtend=function(n,t){return null!=(r=t)&&"function"==typeof r.pipe?_streamExtend(n,t):(n.write(t),n);var r},setExtend=function(n,t){if(null!=t&&t.constructor==Set){for(const r of t)n.add(r);return n}return n.add(t)},callConcat=function(n,t){return n.concat(t)},identityTransform=function(n,t,r){const e=genericReduce(n,t(noop),null);return isPromise(e)?e.then(always(r)):r},genericTransform=function(n,t,r){if(isArray(r))return genericReduce(n,t(arrayExtend),r);if(isBinary(r)){const e=genericReduce(n,t(arrayExtend),[]);return isPromise(e)?e.then(curry2(binaryExtend,r,__)):binaryExtend(r,e)}if(null==r)return identityTransform(n,t,r);const e=r.constructor;return"string"==typeof r||e==String?genericReduce(n,t(add),r):"function"==typeof r.concat?genericReduce(n,t(callConcat),r):"function"==typeof r.write?genericReduce(n,t(streamExtend),r):e==Set?genericReduce(n,t(setExtend),r):e==Object?genericReduce(n,t(objectAssign),r):identityTransform(n,t,r)},transform=function(n,t){return"function"==typeof t?function(...r){const e=t(...r);return isPromise(e)?e.then(curry3(genericTransform,r,n,__)):genericTransform(r,n,e)}:function(...r){return genericTransform(r,n,t)}},arrayPush=function(n,t){return n.push(t),n},FlatMappingIterator=function(n,t){let r=[],e=0;return{[symbolIterator](){return this},next(){if(e<r.length){const n=r[e];return e+=1,{value:n,done:!1}}const o=n.next();if(o.done)return o;const i=genericReduce([t(o.value)],arrayPush,[]);return i.length>1&&(r=i,e=1),{value:i[0],done:!1}}}},FlatMappingAsyncIterator=function(n,t){const r=[],e=new Set;return{[symbolAsyncIterator](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){if(r.length>0)return{value:r.shift(),done:!1};const{value:o,done:i}=await n.next();if(i){for(;e.size>0;)if(await new Promise((n=>setTimeout(n,25))),r.length>0)return{value:r.shift(),done:!1};return{value:void 0,done:!0}}const c=t(o);if(isPromise(c)){const n=c.then(curryArgs3(genericReduce,__,arrayPush,r)).then((()=>e.delete(n)));e.add(n)}else{const n=genericReduce([c],arrayPush,r);if(r.length>0)return{value:r.shift(),done:!1};if(isPromise(n)){const t=n.then((()=>e.delete(t)));e.add(t)}}for(;e.size>0;)if(await new Promise((n=>setTimeout(n,25))),r.length>0)return{value:r.shift(),done:!1};return{value:void 0,done:!0}}}},getArg1=(n,t)=>t,identity=n=>n,asyncIteratorForEach=async function(n,t){const r=[];for await(const e of n){const n=t(e);isPromise(n)&&r.push(n)}return 0==r.length?n:promiseAll(r).then(always(n))},arrayFlatten=function(n){const t=n.length,r=[],e=[];let o=-1;for(;++o<t;){const t=n[o];if(isArray(t)){const n=t.length;let r=-1;for(;++r<n;)e.push(t[r])}else if(null==t)e.push(t);else if("function"==typeof t.then)r.push(t.then(curry2(arrayPush,e,__)));else if("function"==typeof t[symbolIterator])for(const n of t)e.push(n);else if("function"==typeof t[symbolAsyncIterator])r.push(asyncIteratorForEach(t[symbolAsyncIterator](),curry2(arrayPush,e,__)));else if("function"==typeof t.chain){const n=t.chain(identity);isPromise(n)?r.push(n.then(curry2(arrayPush,e,__))):e.push(n)}else if("function"==typeof t.flatMap){const n=t.flatMap(identity);isPromise(n)?r.push(n.then(curry2(arrayPush,e,__))):e.push(n)}else if("function"==typeof t.reduce){const n=t.reduce(funcConcatSync(getArg1,curry2(arrayPush,e,__)),null);isPromise(n)&&r.push(n)}else if(t.constructor==Object)for(const n in t)e.push(t[n]);else e.push(t)}return 0==r.length?e:promiseAll(r).then(always(e))},arrayFlatMap=function(n,t){const r=arrayMap(n,t);return isPromise(r)?r.then(arrayFlatten):arrayFlatten(r)},objectFlatten=function(n){const t=[],r={},e=curry2(objectAssign,r,__),o=funcConcatSync(getArg1,e);for(const i in n){const c=n[i];if(null!=c)if("function"==typeof c[symbolIterator])for(const n of c)objectAssign(r,n);else if("function"==typeof c[symbolAsyncIterator])t.push(asyncIteratorForEach(c[symbolAsyncIterator](),e));else if("function"==typeof c.chain){const n=c.chain(identity);isPromise(n)?t.push(n.then(e)):objectAssign(r,n)}else if("function"==typeof c.flatMap){const n=c.flatMap(identity);isPromise(n)?t.push(n.then(e)):e(n)}else if("function"==typeof c.reduce){const n=c.reduce(o,null);isPromise(n)&&t.push(n)}else objectAssign(r,c)}return 0==t.length?r:promiseAll(t).then((()=>r))},objectFlatMap=function(n,t){const r=objectMap(n,t);return isPromise(r)?r.then(objectFlatten):objectFlatten(r)},setFlatten=function(n){n.size;const t=[],r=new Set,e=(n,t)=>r.add(t),o=curry3(callPropUnary,r,"add",__);for(const i of n)if(isArray(i)){const n=i.length;let t=-1;for(;++t<n;)r.add(i[t])}else if(null==i)r.add(i);else if("function"==typeof i[symbolIterator])for(const n of i)r.add(n);else if("function"==typeof i[symbolAsyncIterator])t.push(asyncIteratorForEach(i[symbolAsyncIterator](),o));else if("function"==typeof i.chain){const n=i.chain(identity);isPromise(n)?t.push(n.then(o)):r.add(n)}else if("function"==typeof i.flatMap){const n=i.flatMap(identity);isPromise(n)?t.push(n.then(o)):r.add(n)}else if("function"==typeof i.reduce){const n=i.reduce(e,null);isPromise(n)&&t.push(n)}else if(i.constructor==Object)for(const n in i)r.add(i[n]);else r.add(i);return 0==t.length?r:promiseAll(t).then((()=>r))},setFlatMap=function(n,t){const r=setMap(n,t);return isPromise(r)?r.then(setFlatten):setFlatten(r)},arrayJoin=(n,t)=>n.join(t),arrayFlattenToString=funcConcat(arrayFlatten,curry2(arrayJoin,__,"")),stringFlatMap=function(n,t){const r=arrayMap(n,t);return isPromise(r)?r.then(arrayFlattenToString):arrayFlattenToString(r)},streamWrite=function(n,t,r,e){return n.write(t,r,e),n},streamFlatExtend=async function(n,t){const r=curry2(streamWrite,n,__),e=funcConcatSync(getArg1,r),o=[];if(isArray(t)){const r=t.length;let e=-1;for(;++e<r;)n.write(t[e])}else if(null==t)n.write(t);else if("function"==typeof t[symbolIterator])for(const r of t)n.write(r);else if("function"==typeof t[symbolAsyncIterator])o.push(asyncIteratorForEach(t[symbolAsyncIterator](),r));else if("function"==typeof t.chain){const e=t.chain(identity);isPromise(e)?o.push(e.then(r)):n.write(e)}else if("function"==typeof t.flatMap){const e=t.flatMap(identity);isPromise(e)?o.push(e.then(r)):n.write(e)}else if("function"==typeof t.reduce){const n=t.reduce(e,null);isPromise(n)&&o.push(n)}else if(t.constructor==Object)for(const r in t)n.write(t[r]);else n.write(t);return 0==o.length?n:promiseAll(o).then(always(n))},streamFlatMap=async function(n,t){const r=new Set;for await(const e of n){const o=t(e);if(isPromise(o)){const t=o.then(curry2(streamFlatExtend,n,__)).then((()=>r.delete(t)));r.add(t)}else{const t=streamFlatExtend(n,o);if(isPromise(t)){const n=t.then((()=>r.delete(n)));r.add(n)}}}return await promiseAll(r),n},arrayJoinToBinary=function(n,t){const r=n.length;let e=-1,o=t;for(;++e<r;)o=binaryExtend(o,n[e]);return o},arrayFlattenToBinary=function(n,t){const r=arrayFlatten(n);return isPromise(r)?r.then(curry2(arrayJoinToBinary,__,t)):arrayJoinToBinary(r,t)},binaryFlatMap=function(n,t){const r=arrayMap(n,t),e=globalThisHasBuffer&&n.constructor==Buffer?bufferAlloc(0):new n.constructor(0);return isPromise(r)?r.then(curry2(arrayFlattenToBinary,__,e)):arrayFlattenToBinary(r,e)},reducerFlatMap=(n,t)=>function(r,e){const o=t(e);return isPromise(o)?o.then(curryArgs3(genericReduce,__,n,r)):genericReduce([o],n,r)},generatorFunctionFlatMap=(n,t)=>function*(...r){yield*FlatMappingIterator(n(...r),t)},asyncGeneratorFunctionFlatMap=(n,t)=>async function*(...r){yield*FlatMappingAsyncIterator(n(...r),t)},flatMap=n=>function(t){if(isArray(t))return arrayFlatMap(t,n);if("function"==typeof t)return isGeneratorFunction(t)?generatorFunctionFlatMap(t,n):isAsyncGeneratorFunction(t)?asyncGeneratorFunctionFlatMap(t,n):reducerFlatMap(t,n);if(isBinary(t))return binaryFlatMap(t,n);if(null==t)return n(t);if("function"==typeof t.then)return t.then(n);if("function"==typeof t.next)return symbolIterator in t?FlatMappingIterator(t,n):FlatMappingAsyncIterator(t,n);if("function"==typeof t.chain)return t.chain(n);if("function"==typeof t.flatMap)return t.flatMap(n);if("function"==typeof t[symbolAsyncIterator]&&"function"==typeof t.write)return streamFlatMap(t,n);const r=t.constructor;return r==Object?objectFlatMap(t,n):r==Set?setFlatMap(t,n):"string"==typeof t||r==String?stringFlatMap(t,n):n(t)},SelfReferencingPromise=function(n){const t=n.then((n=>[n,t]));return t},asyncArrayAny=async function(n,t,r,e){const o=n.length;for(;++r<o;){const o=t(n[r]);if(isPromise(o))e.add(SelfReferencingPromise(o));else if(o)return!0}for(;e.size>0;){const[n,t]=await promiseRace(e);if(e.delete(t),n)return!0}return!1},arrayAny=function(n,t){const r=n.length;let e=-1;for(;++e<r;){const r=t(n[e]);if(isPromise(r))return asyncArrayAny(n,t,e,new Set([SelfReferencingPromise(r)]));if(r)return!0}return!1},asyncIteratorAny=async function(n,t,r,e=20){let o=n.next();for(isPromise(o)&&(o=await o);!o.done;){if(r.size>=e){const[n,t]=await promiseRace(r);if(r.delete(t),n)return!0}const i=t(o.value);if(isPromise(i))r.add(SelfReferencingPromise(i));else if(i)return!0;o=n.next(),isPromise(o)&&(o=await o)}for(;r.size>0;){const[n,t]=await promiseRace(r);if(r.delete(t),n)return!0}return!1},iteratorAny=function(n,t){for(const r of n){const e=t(r);if(isPromise(e))return asyncIteratorAny(n,t,new Set([SelfReferencingPromise(e)]));if(e)return!0}return!1},reducerAnySync=n=>function(t,r){return!!t||n(r)},reducerAny=n=>function(t,r){return!0===t?t:isPromise(t)?t.then(curry2(reducerAnySync(n),__,r)):!!t||n(r)},any=n=>function(t){return isArray(t)?arrayAny(t,n):null==t?n(t):"function"==typeof t[symbolIterator]?iteratorAny(t[symbolIterator](),n):"function"==typeof t[symbolAsyncIterator]?asyncIteratorAny(t[symbolAsyncIterator](),n,new Set):"function"==typeof t.reduce?t.reduce(reducerAny(n),!1):t.constructor==Object?arrayAny(objectValues(t),n):n(t)},arrayAll=function(n,t){const r=n.length,e=[];let o=-1;for(;++o<r;){const r=t(n[o]);if(isPromise(r))e.push(r);else if(!r)return!1}return 0==e.length||promiseAll(e).then(curry3(callPropUnary,__,"every",Boolean))},iteratorAll=function(n,t){const r=[];for(const e of n){const n=t(e);if(isPromise(n))r.push(n);else if(!n)return!1}return 0==r.length||promiseAll(r).then(curry3(callPropUnary,__,"every",Boolean))},asyncIteratorAll=async function(n,t,r,e=20){let o=await n.next();for(;!o.done;){if(r.size>=e){const[n,t]=await promiseRace(r);if(r.delete(t),!n)return!1}const i=t(o.value);if(isPromise(i))r.add(SelfReferencingPromise(i));else if(!i)return!1;o=await n.next()}for(;r.size>0;){const[n,t]=await promiseRace(r);if(r.delete(t),!n)return!1}return!0},reducerAllSync=(n,t,r)=>!!t&&n(r),reducerAll=n=>function(t,r){return!1!==t&&(isPromise(t)?t.then(curry3(reducerAllSync,n,__,r)):!!t&&n(r))},all=n=>function(t){return isArray(t)?arrayAll(t,n):null==t?n(t):"function"==typeof t[symbolIterator]?iteratorAll(t[symbolIterator](),n):"function"==typeof t[symbolAsyncIterator]?asyncIteratorAll(t[symbolAsyncIterator](),n,new Set):"function"==typeof t.reduce?t.reduce(reducerAll(n),!0):t.constructor==Object?arrayAll(objectValues(t),n):n(t)},asyncAnd=async function(n,t,r){const e=n.length;for(;++r<e;){let e=n[r](t);if(isPromise(e)&&(e=await e),!e)return!1}return!0},and=n=>function(t){if(null!=t&&"function"==typeof t.and)return t.and(n);const r=n.length;let e=-1;for(;++e<r;){const r=n[e](t);if(isPromise(r))return r.then(curry3(thunkConditional,__,thunkify3(asyncAnd,n,t,e),always(!1)));if(!r)return!1}return!0},asyncOr=async function(n,t){const r=n.length;let e=-1;for(;++e<r;){let r=n[e](t);if(isPromise(r)&&(r=await r),r)return!0}return!1},_asyncOrInterlude=(n,t,r)=>!!r||asyncOr(n,t),or=n=>function(t){if(null!=t&&"function"==typeof t.or)return t.or(n);const r=n.length;let e=-1;for(;++e<r;){const r=n[e](t);if(isPromise(r))return r.then(curry3(_asyncOrInterlude,n,t,__));if(r)return!0}return!1},_not=n=>!n,not=n=>function(t){if(null!=t&&"function"==typeof t.not)return t.not(n);const r=n(t);return isPromise(r)?r.then(_not):!r},notSync=n=>function(...t){return!n(...t)};not.sync=notSync;const sameValueZero=function(n,t){return n===t||n!=n&&t!=t},eq=function(n,t){const r="function"==typeof n,e="function"==typeof t;return r&&e?function(r){const e=n(r),o=t(r),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(sameValueZero)):i?e.then(curry2(sameValueZero,__,o)):c?o.then(curry2(sameValueZero,e,__)):sameValueZero(e,o)}:r?function(r){const e=n(r);return isPromise(e)?e.then(curry2(sameValueZero,__,t)):sameValueZero(e,t)}:e?function(r){const e=t(r);return isPromise(e)?e.then(curry2(sameValueZero,n,__)):sameValueZero(n,e)}:function(r){return null!=r&&"function"==typeof r.eq?r.eq(n,t):sameValueZero(n,t)}},greaterThan=(n,t)=>n>t,gt=function(n,t){const r="function"==typeof n,e="function"==typeof t;return r&&e?function(r){const e=n(r),o=t(r),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(greaterThan)):i?e.then(curry2(greaterThan,__,o)):c?o.then(curry2(greaterThan,e,__)):e>o}:r?function(r){const e=n(r);return isPromise(e)?e.then(curry2(greaterThan,__,t)):e>t}:e?function(r){const e=t(r);return isPromise(e)?e.then(curry2(greaterThan,n,__)):n>e}:function(r){return null!=r&&"function"==typeof r.eq?r.gt(n,t):n>t}},lessThan=(n,t)=>n<t,lt=function(n,t){const r="function"==typeof n,e="function"==typeof t;return r&&e?function(r){const e=n(r),o=t(r),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(lessThan)):i?e.then(curry2(lessThan,__,o)):c?o.then(curry2(lessThan,e,__)):e<o}:r?function(r){const e=n(r);return isPromise(e)?e.then(curry2(lessThan,__,t)):e<t}:e?function(r){const e=t(r);return isPromise(e)?e.then(curry2(lessThan,n,__)):n<e}:function(r){return null!=r&&"function"==typeof r.eq?r.lt(n,t):n<t}},greaterThanOrEqual=(n,t)=>n>=t,gte=function(n,t){const r="function"==typeof n,e="function"==typeof t;return r&&e?function(r){const e=n(r),o=t(r),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(greaterThanOrEqual)):i?e.then(curry2(greaterThanOrEqual,__,o)):c?o.then(curry2(greaterThanOrEqual,e,__)):e>=o}:r?function(r){const e=n(r);return isPromise(e)?e.then(curry2(greaterThanOrEqual,__,t)):e>=t}:e?function(r){const e=t(r);return isPromise(e)?e.then(curry2(greaterThanOrEqual,n,__)):n>=e}:function(r){return null!=r&&"function"==typeof r.eq?r.gte(n,t):n>=t}},lessThanOrEqual=(n,t)=>n<=t,lte=function(n,t){const r="function"==typeof n,e="function"==typeof t;return r&&e?function(r){const e=n(r),o=t(r),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(lessThanOrEqual)):i?e.then(curry2(lessThanOrEqual,__,o)):c?o.then(curry2(lessThanOrEqual,e,__)):e<=o}:r?function(r){const e=n(r);return isPromise(e)?e.then(curry2(lessThanOrEqual,__,t)):e<=t}:e?function(r){const e=t(r);return isPromise(e)?e.then(curry2(lessThanOrEqual,n,__)):n<=e}:function(r){return null!=r&&"function"==typeof r.eq?r.lte(n,t):n<=t}},memoizeCappedUnary=function(n,t){const r=new Map,e=function(e){if(r.has(e))return r.get(e);const o=n(e);return r.set(e,o),r.size>t&&r.clear(),o};return e.cache=r,e},pathDelimiters=/[.|[|\]]+/,parsePropertyPath=function(n){const t=n.length-1,r="["==n[0],e="]"==n[t];return r&&e?n.slice(1,t).split(pathDelimiters):r?n.slice(1).split(pathDelimiters):e?n.slice(0,t).split(pathDelimiters):n.split(pathDelimiters)},memoizedCappedParsePropertyPath=memoizeCappedUnary(parsePropertyPath,500),propertyPathToArray=n=>isArray(n)?n:"string"==typeof n?memoizedCappedParsePropertyPath(n):[n],getByPath=function(n,t){const r=propertyPathToArray(t),e=r.length;let o=-1,i=n;for(;++o<e;)if(i=i[r[o]],null==i)return;return i},get=(n,t)=>function(r){const e=null==r?void 0:getByPath(r,n);return void 0===e?"function"==typeof t?t(r):t:e},pick=n=>function(t){if(null==t)return t;const r=n.length,e={};let o=-1;for(;++o<r;){const r=n[o],i=t[r];null!=i&&(e[r]=i)}return e},deleteByPath=function(n,t){if(null==n)return;const r=propertyPathToArray(t),e=r.length-1;let o=-1,i=n;for(;++o<e;)if(i=i[r[o]],null==i)return;const c=r[o];null!=i&&c in i&&delete i[c]},objectCopyDeep=function(n){const t={};for(const r in n){const e=n[r];isArray(e)?t[r]=arrayCopyDeep(e):null!=e&&e.constructor==Object?t[r]=objectCopyDeep(e):t[r]=e}return t},arrayCopyDeep=function(n){const t=n.length,r=[];let e=-1;for(;++e<t;){const t=n[e];isArray(t)?r[e]=arrayCopyDeep(t):null!=t&&t.constructor==Object?r[e]=objectCopyDeep(t):r[e]=t}return r},copyDeep=function(n){return isArray(n)?arrayCopyDeep(n):null==n?n:n.constructor==Object?objectCopyDeep(n):n},omit=n=>function(t){const r=n.length,e=isArray(o=t)?arrayCopyDeep(o):null==o?o:o.constructor==Object?objectCopyDeep(o):o;var o;let i=-1;for(;++i<r;)deleteByPath(e,n[i]);return e},thunkify=(n,...t)=>function(){return n(...t)},curry=(n,...t)=>curryArity(n.length,n,t);curry.arity=function(n,t,...r){return curryArity(n,t,r)};const rubico={pipe:pipe,tap:tap,switchCase:switchCase,tryCatch:tryCatch,fork:fork,assign:assign,get:get,pick:pick,omit:omit,map:map,filter:filter,reduce:reduce,transform:transform,flatMap:flatMap,and:and,or:or,not:not,any:any,all:all,eq:eq,gt:gt,lt:lt,gte:gte,lte:lte,thunkify:thunkify,always:always,curry:curry,__:__};export default rubico;
